import{a as Se}from"./chunk-X344YWBZ.js";import{Da as Ee,Ha as Oe,a as Ce,d as xe,l as he,la as ve,m as be,p as Pe}from"./chunk-TI2PQS3J.js";import{a as ge}from"./chunk-XRERQNEZ.js";import"./chunk-JQ3F7U5Y.js";import{A as w,Aa as J,B as t,C as n,D as d,E as F,F as O,G as x,Ga as K,Ha as Q,Ia as W,Ja as X,K as i,Ka as Y,L as D,M as b,Ma as Z,N as z,Oa as ee,R as k,Sa as te,T as P,Ua as ne,V as v,Ya as oe,Z as B,Za as ie,_ as q,_a as ae,db as re,eb as le,ia as N,ib as se,j as g,jb as ce,k as y,l as M,m as R,na as _,o as a,oa as $,ob as de,pa as G,pb as me,qb as ue,r as f,ra as V,s as C,sa as j,sb as pe,ta as A,tb as fe,ua as H,va as L,w as m,wb as _e,x as T,xa as U,z as I}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as p}from"./chunk-B4AJQJMI.js";function Me(o,s){o&1&&d(0,"ion-spinner",10)}function Re(o,s){o&1&&d(0,"ion-icon",11)}function Fe(o,s){o&1&&(t(0,"ion-note",20),i(1,"El monto es obligatorio"),n())}function ye(o,s){o&1&&(t(0,"ion-note",20),i(1,"El monto excede los fondos disponibles"),n())}function Te(o,s){o&1&&(t(0,"ion-note",20),i(1,"El monto m\xEDnimo es $10"),n())}function Ie(o,s){o&1&&(t(0,"ion-note",20),i(1,"Selecciona un banco"),n())}function we(o,s){o&1&&(t(0,"ion-note",20),i(1,"El n\xFAmero de cuenta es obligatorio"),n())}function De(o,s){o&1&&(t(0,"ion-note",20),i(1,"El CBU/CVU debe tener 22 d\xEDgitos"),n())}function ze(o,s){o&1&&(t(0,"ion-note",20),i(1,"El nombre del titular es obligatorio"),n())}function ke(o,s){o&1&&(d(0,"ion-spinner",31),t(1,"span"),i(2,"Procesando..."),n())}function Be(o,s){o&1&&(d(0,"ion-icon",32),i(1," Solicitar Retiro "))}function qe(o,s){if(o&1){let e=F();t(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),d(3,"ion-icon",16),i(4," Datos para transferencia "),n()(),t(5,"ion-card-content")(6,"form",17),O("ngSubmit",function(){M(e);let l=x();return R(l.procesarRetiro())}),t(7,"ion-item")(8,"ion-label",18),i(9,"Monto a retirar"),n(),d(10,"ion-input",19),n(),f(11,Fe,2,0,"ion-note",20)(12,ye,2,0,"ion-note",20)(13,Te,2,0,"ion-note",20),t(14,"ion-item")(15,"ion-label",18),i(16,"Banco"),n(),t(17,"ion-select",21)(18,"ion-select-option",22),i(19,"Banco Pichincha"),n(),t(20,"ion-select-option",23),i(21,"Banco Guayaquil"),n(),t(22,"ion-select-option",24),i(23,"Santander"),n(),t(24,"ion-select-option",25),i(25,"BBVA"),n(),t(26,"ion-select-option",26),i(27,"DeUna"),n(),t(28,"ion-select-option",27),i(29,"Otro"),n()()(),f(30,Ie,2,0,"ion-note",20),t(31,"ion-item")(32,"ion-label",18),i(33,"N\xFAmero de cuenta"),n(),d(34,"ion-input",28),n(),f(35,we,2,0,"ion-note",20)(36,De,2,0,"ion-note",20),t(37,"ion-item")(38,"ion-label",18),i(39,"Nombre del titular"),n(),d(40,"ion-input",29),n(),f(41,ze,2,0,"ion-note",20),t(42,"ion-button",30),f(43,ke,3,0)(44,Be,2,0),n()()()()}if(o&2){let e,r,l,u,h,S,E,c=x();a(6),C("formGroup",c.formulario),a(4),C("max",c.fondosDisponibles),a(),m((e=c.formulario.get("monto"))!=null&&e.touched&&(!((e=c.formulario.get("monto"))==null||e.errors==null)&&e.errors.required)?11:-1),a(),m(!((r=c.formulario.get("monto"))==null||r.errors==null)&&r.errors.max?12:-1),a(),m(!((l=c.formulario.get("monto"))==null||l.errors==null)&&l.errors.min?13:-1),a(17),m((u=c.formulario.get("banco"))!=null&&u.touched&&(!((u=c.formulario.get("banco"))==null||u.errors==null)&&u.errors.required)?30:-1),a(5),m((h=c.formulario.get("numeroCuenta"))!=null&&h.touched&&(!((h=c.formulario.get("numeroCuenta"))==null||h.errors==null)&&h.errors.required)?35:-1),a(),m(!((S=c.formulario.get("numeroCuenta"))==null||S.errors==null)&&S.errors.minlength?36:-1),a(5),m((E=c.formulario.get("titular"))!=null&&E.touched&&(!((E=c.formulario.get("titular"))==null||E.errors==null)&&E.errors.required)?41:-1),a(),C("disabled",!c.formulario.valid||c.procesando),a(),m(c.procesando?43:44)}}function Ne(o,s){o&1&&d(0,"ion-spinner",31)}function $e(o,s){o&1&&i(0," Actualizar Fondos ")}function Ge(o,s){if(o&1){let e=F();t(0,"ion-card",15)(1,"ion-card-content"),d(2,"ion-icon",6),t(3,"h3"),i(4,"Sin fondos disponibles"),n(),t(5,"p"),i(6,"Completa trabajos para acumular ganancias que puedas retirar."),n(),t(7,"ion-button",33),O("click",function(){M(e);let l=x();return R(l.recalcularFondos())}),f(8,Ne,1,0,"ion-spinner",31)(9,$e,1,0),n()()()}if(o&2){let e=x();a(7),C("disabled",e.recalculando),a(),m(e.recalculando?8:9)}}function Ve(o,s){if(o&1&&(t(0,"ion-item"),d(1,"ion-icon",35),t(2,"ion-label")(3,"h3"),i(4),P(5,"number"),n(),t(6,"p"),i(7),n(),t(8,"p",36),i(9),P(10,"date"),n()(),t(11,"ion-note",37),i(12),n()()),o&2){let e=s.$implicit,r=x(2);a(),C("name",r.obtenerIconoEstado(e.estado))("color",r.obtenerColorEstado(e.estado)),a(3),b("$",v(5,8,e.monto,"1.2-2"),""),a(3),z("",e.banco," - ****",e.numeroCuenta==null?null:e.numeroCuenta.slice(-4),""),a(2),D(v(10,11,e.fecha,"dd/MM/yyyy HH:mm")),a(2),C("color",r.obtenerColorEstado(e.estado)),a(),b(" ",r.obtenerEtiquetaEstado(e.estado)," ")}}function je(o,s){if(o&1&&(t(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),d(3,"ion-icon",34),i(4," Historial de Retiros "),n()(),t(5,"ion-card-content")(6,"ion-list"),I(7,Ve,13,14,"ion-item",null,T),n()()()),o&2){let e=x();a(7),w(e.historialRetiros)}}var ot=(()=>{class o{constructor(){this.router=g(N),this.fb=g(L),this.authServicio=g(ge),this.usuariosServicio=g(Se),this.alertCtrl=g(de),this.toastCtrl=g(ue),this.loadingCtrl=g(me),this.fondosDisponibles=0,this.totalGanado=0,this.totalRetirado=0,this.historialRetiros=[],this.procesando=!1,this.recalculando=!1,Ce({walletOutline:Oe,cashOutline:be,cardOutline:he,checkmarkCircleOutline:Pe,timeOutline:Ee,alertCircleOutline:xe,refreshOutline:ve})}ngOnInit(){this.cargarDatos(),this.inicializarFormulario()}cargarDatos(){this.authServicio.usuarioActual$.subscribe(e=>{e?.datosTecnico?.fondos&&(this.fondosDisponibles=e.datosTecnico.fondos.disponible||0,this.totalGanado=e.datosTecnico.fondos.totalGanado||0,this.totalRetirado=e.datosTecnico.fondos.totalRetirado||0),e?.datosTecnico?.historialRetiros&&(this.historialRetiros=e.datosTecnico.historialRetiros||[])})}inicializarFormulario(){this.formulario=this.fb.group({monto:[null,[_.required,_.min(10),_.max(this.fondosDisponibles)]],banco:["",_.required],numeroCuenta:["",[_.required,_.minLength(22),_.maxLength(22)]],titular:["",_.required]})}procesarRetiro(){return p(this,null,function*(){if(!this.formulario.valid){this.formulario.markAllAsTouched();return}let e=this.formulario.value.monto;if(e>this.fondosDisponibles){yield this.mostrarToast("El monto excede los fondos disponibles","danger");return}yield(yield this.alertCtrl.create({header:"Confirmar Retiro",message:`\xBFDeseas retirar $${e.toFixed(2)} a tu cuenta bancaria?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:()=>this.ejecutarRetiro()}]})).present()})}ejecutarRetiro(){return p(this,null,function*(){this.procesando=!0;let e=yield this.loadingCtrl.create({message:"Procesando solicitud...",spinner:"crescent"});yield e.present();let r={monto:this.formulario.value.monto,banco:this.formulario.value.banco,numeroCuenta:this.formulario.value.numeroCuenta,titular:this.formulario.value.titular};this.usuariosServicio.retirarFondos(r).subscribe({next:l=>p(this,null,function*(){if(yield e.dismiss(),this.procesando=!1,l.exito){let u=r.monto;this.fondosDisponibles-=u,this.totalRetirado+=u,this.historialRetiros.unshift({monto:u,fecha:new Date,estado:"completado",banco:r.banco,numeroCuenta:r.numeroCuenta}),yield(yield this.alertCtrl.create({header:"\u2705 \xA1Retiro Exitoso!",message:`Se han enviado $${u.toFixed(2)} a tu cuenta bancaria. El dep\xF3sito se reflejar\xE1 en las pr\xF3ximas 24-48 horas h\xE1biles.`,buttons:["Entendido"]})).present(),this.formulario.reset(),this.authServicio.cargarUsuario()}else yield this.mostrarToast(l.mensaje||"Error al procesar retiro","danger")}),error:l=>p(this,null,function*(){yield e.dismiss(),this.procesando=!1,console.error("Error en retiro:",l),yield this.mostrarToast(l.error?.mensaje||"Error al procesar retiro","danger")})})})}obtenerIconoEstado(e){return{pendiente:"time-outline",procesando:"time-outline",completado:"checkmark-circle-outline",rechazado:"alert-circle-outline"}[e]||"time-outline"}obtenerColorEstado(e){return{pendiente:"warning",procesando:"warning",completado:"success",rechazado:"danger"}[e]||"medium"}obtenerEtiquetaEstado(e){return{pendiente:"Pendiente",procesando:"Procesando",completado:"Completado",rechazado:"Rechazado"}[e]||e}recalcularFondos(){return p(this,null,function*(){this.recalculando=!0,this.usuariosServicio.recalcularFondos().subscribe({next:e=>p(this,null,function*(){this.recalculando=!1,e.exito&&e.datos&&(this.fondosDisponibles=e.datos.fondosDisponibles||0,this.totalGanado=e.datos.totalGanado||0,this.totalRetirado=e.datos.totalRetirado||0,this.inicializarFormulario(),this.authServicio.cargarUsuario(),yield this.mostrarToast(`Fondos actualizados: $${this.fondosDisponibles.toFixed(2)} disponibles`,"success"))}),error:e=>p(this,null,function*(){this.recalculando=!1,console.error("Error al recalcular:",e),yield this.mostrarToast("Error al actualizar fondos","danger")})})})}mostrarToast(e,r="primary"){return p(this,null,function*(){yield(yield this.toastCtrl.create({message:e,duration:2e3,color:r,position:"bottom"})).present()})}static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275cmp=y({type:o,selectors:[["app-retirar-fondos"]],standalone:!0,features:[k],decls:37,vars:16,consts:[["slot","start"],["defaultHref","/tabs/perfil"],[1,"ion-padding"],[1,"fondos-card"],[1,"fondos-resumen"],[1,"fondos-disponible"],["name","wallet-outline"],[1,"label"],[1,"monto"],["fill","clear","size","small",1,"btn-refresh",3,"click","disabled"],["name","crescent","color","light"],["name","refresh-outline","color","light"],[1,"fondos-stats"],[1,"stat"],[1,"value"],[1,"sin-fondos"],["name","card-outline"],[3,"ngSubmit","formGroup"],["position","stacked"],["type","number","formControlName","monto","placeholder","Ingresa el monto",3,"max"],["color","danger",1,"error-note"],["formControlName","banco","placeholder","Selecciona tu banco"],["value","banco_pichincha"],["value","banco_guayaquil"],["value","santander"],["value","bbva"],["value","de_una"],["value","otro"],["type","text","formControlName","numeroCuenta","placeholder","Ej: 0000003100000000000001","maxlength","22"],["type","text","formControlName","titular","placeholder","Como aparece en el banco"],["expand","block","type","submit",1,"btn-retirar",3,"disabled"],["name","crescent"],["name","cash-outline","slot","start"],["fill","outline","size","small",3,"click","disabled"],["name","time-outline"],["slot","start",3,"name","color"],[1,"fecha"],["slot","end",3,"color"]],template:function(r,l){r&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),d(3,"ion-back-button",1),n(),t(4,"ion-title"),i(5,"Retirar Fondos"),n()()(),t(6,"ion-content",2)(7,"ion-card",3)(8,"ion-card-content")(9,"div",4)(10,"div",5),d(11,"ion-icon",6),t(12,"div")(13,"span",7),i(14,"Disponible para retiro"),n(),t(15,"span",8),i(16),P(17,"number"),n()(),t(18,"ion-button",9),O("click",function(){return l.recalcularFondos()}),f(19,Me,1,0,"ion-spinner",10)(20,Re,1,0,"ion-icon",11),n()(),t(21,"div",12)(22,"div",13)(23,"span",14),i(24),P(25,"number"),n(),t(26,"span",7),i(27,"Total ganado"),n()(),t(28,"div",13)(29,"span",14),i(30),P(31,"number"),n(),t(32,"span",7),i(33,"Total retirado"),n()()()()()(),f(34,qe,45,11,"ion-card")(35,Ge,10,2,"ion-card",15)(36,je,9,0,"ion-card"),n()),r&2&&(a(16),b("$",v(17,7,l.fondosDisponibles,"1.2-2"),""),a(2),C("disabled",l.recalculando),a(),m(l.recalculando?19:20),a(5),b("$",v(25,10,l.totalGanado,"1.2-2"),""),a(6),b("$",v(31,13,l.totalRetirado,"1.2-2"),""),a(4),m(l.fondosDisponibles>0?34:35),a(2),m(l.historialRetiros.length>0?36:-1))},dependencies:[ee,te,ce,se,Q,J,W,X,Y,Z,ne,oe,fe,_e,re,K,pe,le,ie,ae,q,B,U,V,$,G,H,j,A],styles:[".fondos-card[_ngcontent-%COMP%]{margin-bottom:16px;background:linear-gradient(135deg,var(--ion-color-success),var(--ion-color-success-shade));color:#fff}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-disponible[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid rgba(255,255,255,.2)}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-disponible[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:48px}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-disponible[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-disponible[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:12px;opacity:.9}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-disponible[_ngcontent-%COMP%]   .monto[_ngcontent-%COMP%]{display:block;font-size:32px;font-weight:700}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-disponible[_ngcontent-%COMP%]   .btn-refresh[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;margin:0}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{text-align:center}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:block;font-size:18px;font-weight:600}.fondos-card[_ngcontent-%COMP%]   .fondos-resumen[_ngcontent-%COMP%]   .fondos-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:11px;opacity:.8}ion-card[_ngcontent-%COMP%]{border-radius:12px;margin-bottom:16px}ion-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:18px}ion-card-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;margin-bottom:12px}.error-note[_ngcontent-%COMP%]{display:block;padding:4px 0 8px;font-size:12px}.btn-retirar[_ngcontent-%COMP%]{margin-top:24px;height:48px}.btn-retirar[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-right:8px}.sin-fondos[_ngcontent-%COMP%]{text-align:center;padding:32px 16px}.sin-fondos[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:var(--ion-color-medium);margin-bottom:16px}.sin-fondos[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:var(--ion-text-color)}.sin-fondos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0}.fecha[_ngcontent-%COMP%]{font-size:11px!important;color:var(--ion-color-medium)}"]})}}return o})();export{ot as RetirarFondosPage};
