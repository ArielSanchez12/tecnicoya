import{Aa as Mi,D as vi,Da as Ii,Ea as wi,L as Ni,a as gi,d as hi,ea as Pi,ha as Oi,n as Ci,p as xi,q as bi}from"./chunk-TI2PQS3J.js";import{a as _i}from"./chunk-JQ3F7U5Y.js";import{A as j,Aa as J,B as o,C as a,D as r,E as v,F as u,Fa as Z,G as s,Ga as G,Ha as K,K as l,L as N,M,O as z,Oa as Q,P as F,Q as D,R as V,Sa as X,T as $,Ua as Y,V as B,Va as ii,Wa as ei,Xa as ti,Ya as ni,Z as A,Za as oi,_a as ai,ab as ci,b as I,bb as ri,ca as U,cb as si,h as C,i as w,ia as H,ib as li,j as f,jb as di,k as y,l as x,m as b,o as c,oa as R,ob as mi,q as S,qa as W,qb as fi,r as _,s as k,sb as ui,u as L,v as T,vb as pi,w as g,wa as q,z as E}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as P,b as O,h as p}from"./chunk-B4AJQJMI.js";var yi=(()=>{class e{constructor(){this.http=f(U),this.apiUrl=`${_i.apiUrl}/notificaciones`,this._notificaciones=new I([]),this.notificaciones$=this._notificaciones.asObservable(),this.contadorNoLeidas=S(0)}obtenerNotificaciones(){return this.http.get(this.apiUrl).pipe(C(i=>{i.datos&&(this._notificaciones.next(i.datos),this.actualizarContador(i.datos))}))}marcarLeida(i){return this.http.put(`${this.apiUrl}/${i}/leer`,{}).pipe(C(()=>{let t=this._notificaciones.value.map(n=>n._id===i?O(P({},n),{leida:!0}):n);this._notificaciones.next(t),this.actualizarContador(t)}))}marcarTodasLeidas(){return this.http.put(`${this.apiUrl}/leer-todas`,{}).pipe(C(()=>{let i=this._notificaciones.value.map(t=>O(P({},t),{leida:!0}));this._notificaciones.next(i),this.contadorNoLeidas.set(0)}))}eliminar(i){return this.http.delete(`${this.apiUrl}/${i}`).pipe(C(()=>{let t=this._notificaciones.value.filter(n=>n._id!==i);this._notificaciones.next(t),this.actualizarContador(t)}))}agregarNotificacion(i){let t=[i,...this._notificaciones.value];this._notificaciones.next(t),this.actualizarContador(t)}actualizarContador(i){let t=i.filter(n=>!n.leida).length;this.contadorNoLeidas.set(t)}solicitarPermisosPush(){return p(this,null,function*(){return"Notification"in window?(yield Notification.requestPermission())==="granted":!1})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var ki=(e,d)=>d._id;function Li(e,d){if(e&1){let i=v();o(0,"ion-button",9),u("click",function(){x(i);let n=s();return b(n.marcarTodasLeidas())}),r(1,"ion-icon",10),a()}}function Ti(e,d){if(e&1&&(o(0,"ion-badge",6),l(1),a()),e&2){let i=s();c(),N(i.notificacionesNoLeidas)}}function Ei(e,d){if(e&1&&(o(0,"div",8),r(1,"ion-icon",11),o(2,"h2"),l(3,"Sin notificaciones"),a(),o(4,"p"),l(5),a()()),e&2){let i=s();c(5),M("No tienes notificaciones ",i.filtroActual==="no-leidas"?"sin leer":"","")}}function ji(e,d){e&1&&r(0,"div",16)}function zi(e,d){if(e&1){let i=v();o(0,"ion-item-option",21),u("click",function(){x(i);let n=s().$implicit,m=s(2);return b(m.marcarLeida(n))}),r(1,"ion-icon",22),a()}}function Fi(e,d){if(e&1){let i=v();o(0,"ion-item-sliding")(1,"ion-item",12),u("click",function(){let n=x(i).$implicit,m=s(2);return b(m.abrirNotificacion(n))}),o(2,"div",13),r(3,"ion-icon",14),a(),o(4,"ion-label")(5,"h3"),l(6),a(),o(7,"p"),l(8),a(),o(9,"ion-note"),r(10,"ion-icon",15),l(11),$(12,"date"),a()(),_(13,ji,1,0,"div",16),a(),o(14,"ion-item-options",17),_(15,zi,2,0,"ion-item-option",18),o(16,"ion-item-option",19),u("click",function(){let n=x(i).$implicit,m=s(2);return b(m.eliminar(n))}),r(17,"ion-icon",20),a()()()}if(e&2){let i=d.$implicit,t=s(2);c(),L("no-leida",!i.leida),c(),T(i.tipo),c(),k("name",t.obtenerIcono(i.tipo)),c(3),N(i.titulo),c(2),N(i.mensaje),c(3),M(" ",B(12,10,i.fecha,"dd/MM/yyyy HH:mm")," "),c(2),g(i.leida?-1:13),c(2),g(i.leida?-1:15)}}function Di(e,d){if(e&1&&(o(0,"ion-list"),E(1,Fi,18,13,"ion-item-sliding",null,ki),a()),e&2){let i=s();c(),j(i.notificacionesFiltradas)}}var oe=(()=>{class e{constructor(){this.router=f(H),this.notificacionesServicio=f(yi),this.alertCtrl=f(mi),this.toastCtrl=f(fi),this.notificaciones=[],this.notificacionesFiltradas=[],this.filtroActual="todas",this.notificacionesNoLeidas=0,gi({notificationsOutline:Oi,checkmarkCircleOutline:xi,alertCircleOutline:hi,chatbubbleOutline:Ci,documentTextOutline:vi,starOutline:Mi,trashOutline:wi,checkmarkDoneOutline:bi,megaphoneOutline:Pi,timeOutline:Ii,giftOutline:Ni})}ngOnInit(){this.cargarNotificaciones()}cargarNotificaciones(){this.notificacionesServicio.obtenerNotificaciones().subscribe({next:i=>{this.notificaciones=i.datos||[],this.contarNoLeidas(),this.filtrarNotificaciones()},error:()=>{this.notificaciones=[{_id:"1",tipo:"servicio",titulo:"Nuevo servicio asignado",mensaje:"Se te ha asignado un servicio de plomer\xEDa en Zona Norte",leida:!1,fecha:new Date},{_id:"2",tipo:"cotizacion",titulo:"Nueva cotizaci\xF3n recibida",mensaje:"Un t\xE9cnico ha enviado una cotizaci\xF3n para tu solicitud",leida:!1,fecha:new Date(Date.now()-36e5)},{_id:"3",tipo:"mensaje",titulo:"Nuevo mensaje",mensaje:"Juan P\xE9rez te ha enviado un mensaje",leida:!0,fecha:new Date(Date.now()-864e5)},{_id:"4",tipo:"resena",titulo:"\xA1Nueva rese\xF1a!",mensaje:"Has recibido una calificaci\xF3n de 5 estrellas",leida:!0,fecha:new Date(Date.now()-1728e5)},{_id:"5",tipo:"promocion",titulo:"\xA1Oferta especial!",mensaje:"20% de descuento en tu pr\xF3ximo servicio",leida:!0,fecha:new Date(Date.now()-2592e5)}],this.contarNoLeidas(),this.filtrarNotificaciones()}})}contarNoLeidas(){this.notificacionesNoLeidas=this.notificaciones.filter(i=>!i.leida).length}filtrarNotificaciones(){this.filtroActual==="no-leidas"?this.notificacionesFiltradas=this.notificaciones.filter(i=>!i.leida):this.notificacionesFiltradas=[...this.notificaciones]}obtenerIcono(i){return{servicio:"document-text-outline",cotizacion:"document-text-outline",mensaje:"chatbubble-outline",resena:"star-outline",sistema:"alert-circle-outline",promocion:"gift-outline"}[i]||"notifications-outline"}abrirNotificacion(i){if(i.leida||this.marcarLeida(i),i.referencia)switch(i.referencia.tipo){case"servicio":this.router.navigate(["/detalle-servicio",i.referencia.id]);break;case"mensaje":this.router.navigate(["/chat",i.referencia.id]);break}}marcarLeida(i){i.leida=!0,this.notificacionesServicio.marcarLeida(i._id).subscribe(),this.contarNoLeidas(),this.filtrarNotificaciones()}marcarTodasLeidas(){return p(this,null,function*(){this.notificaciones.forEach(t=>t.leida=!0),this.notificacionesServicio.marcarTodasLeidas().subscribe(),this.contarNoLeidas(),this.filtrarNotificaciones(),yield(yield this.toastCtrl.create({message:"Todas las notificaciones marcadas como le\xEDdas",duration:2e3,position:"bottom"})).present()})}eliminar(i){return p(this,null,function*(){yield(yield this.alertCtrl.create({header:"Eliminar notificaci\xF3n",message:"\xBFEst\xE1s seguro de eliminar esta notificaci\xF3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:()=>{this.notificaciones=this.notificaciones.filter(n=>n._id!==i._id),this.notificacionesServicio.eliminar(i._id).subscribe(),this.contarNoLeidas(),this.filtrarNotificaciones()}}]})).present()})}refrescar(i){return p(this,null,function*(){this.cargarNotificaciones(),setTimeout(()=>{i.target.complete()},1e3)})}static{this.\u0275fac=function(t){return new(t||e)}}static{this.\u0275cmp=y({type:e,selectors:[["app-notificaciones"]],standalone:!0,features:[V],decls:22,vars:4,consts:[["slot","start"],["defaultHref","/tabs/perfil"],["slot","end"],[3,"ngModelChange","ionChange","ngModel"],["value","todas"],["value","no-leidas"],["color","danger"],["slot","fixed",3,"ionRefresh"],[1,"empty-state"],[3,"click"],["name","checkmark-done-outline","slot","icon-only"],["name","notifications-outline"],["button","",3,"click"],["slot","start",1,"icono-notificacion"],[3,"name"],["name","time-outline"],["slot","end",1,"indicador-no-leida"],["side","end"],["color","primary"],["color","danger",3,"click"],["name","trash-outline","slot","icon-only"],["color","primary",3,"click"],["name","checkmark-circle-outline","slot","icon-only"]],template:function(t,n){t&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r(3,"ion-back-button",1),a(),o(4,"ion-title"),l(5,"Notificaciones"),a(),o(6,"ion-buttons",2),_(7,Li,2,0,"ion-button"),a()(),o(8,"ion-toolbar")(9,"ion-segment",3),D("ngModelChange",function(h){return F(n.filtroActual,h)||(n.filtroActual=h),h}),u("ionChange",function(){return n.filtrarNotificaciones()}),o(10,"ion-segment-button",4)(11,"ion-label"),l(12,"Todas"),a()(),o(13,"ion-segment-button",5)(14,"ion-label"),l(15,"No le\xEDdas"),a(),_(16,Ti,2,1,"ion-badge",6),a()()()(),o(17,"ion-content")(18,"ion-refresher",7),u("ionRefresh",function(h){return n.refrescar(h)}),r(19,"ion-refresher-content"),a(),_(20,Ei,6,1,"div",8)(21,Di,3,0,"ion-list"),a()),t&2&&(c(7),g(n.notificacionesNoLeidas>0?7:-1),c(2),z("ngModel",n.filtroActual),c(7),g(n.notificacionesNoLeidas>0?16:-1),c(4),g(n.notificacionesFiltradas.length===0?20:21))},dependencies:[Q,X,di,li,K,J,oi,Y,ni,ui,Z,G,ti,ei,ii,ci,ri,pi,si,ai,A,q,R,W],styles:[".empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 24px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:80px;color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 8px;color:var(--ion-color-dark)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium)}ion-item.no-leida[_ngcontent-%COMP%]{--background: var(--ion-color-primary-tint)}.icono-notificacion[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:12px}.icono-notificacion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px;color:#fff}.icono-notificacion.servicio[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2)}.icono-notificacion.cotizacion[_ngcontent-%COMP%]{background:linear-gradient(135deg,#11998e,#38ef7d)}.icono-notificacion.mensaje[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0072ff,#00c6ff)}.icono-notificacion.resena[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f093fb,#f5576c)}.icono-notificacion.sistema[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4facfe,#00f2fe)}.icono-notificacion.promocion[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fa709a,#fee140)}ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;margin-bottom:4px}ion-label[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--ion-color-medium)}ion-label[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.indicador-no-leida[_ngcontent-%COMP%]{width:10px;height:10px;background:var(--ion-color-primary);border-radius:50%}ion-segment-button[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:4px}"]})}}return e})();export{oe as NotificacionesPage};
