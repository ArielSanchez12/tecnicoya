import{a as ye}from"./chunk-RER3LUMB.js";import{a as ke}from"./chunk-VZSTYWCH.js";import{a as Ee}from"./chunk-WXOXMQ3X.js";import{Aa as Oe,Ba as we,Ca as Te,Da as Me,Ia as Se,K as fe,_ as xe,a as re,c as le,ga as he,h as ce,i as se,j as de,k as me,ka as ve,m as pe,n as ue,p as _e,u as ge,ua as Pe,x as be,z as Ce,za as je}from"./chunk-TI2PQS3J.js";import{a as ae}from"./chunk-XRERQNEZ.js";import"./chunk-JQ3F7U5Y.js";import{A as k,Aa as R,B as t,C as n,D as c,E as C,Ea as q,F as b,Fa as B,G as d,Ga as U,Ha as $,Ia as L,Ja as N,K as r,Ka as H,L as P,La as G,M as O,Ma as J,N as T,Na as K,Oa as Q,R as D,Sa as W,T as I,V as F,Ya as X,Z as V,eb as Y,ga as z,ia as A,ib as Z,j as x,jb as ee,k as S,l as _,m as g,n as w,o as l,ob as te,pb as ne,qb as ie,r as f,s as h,sb as oe,u as v,w as u,x as E,z as y}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as m}from"./chunk-B4AJQJMI.js";function Ie(a,p){a&1&&(t(0,"div",2),c(1,"ion-spinner"),t(2,"p"),r(3,"Cargando trabajo..."),n()())}function Fe(a,p){if(a&1&&(t(0,"div",13),c(1,"ion-icon",27),t(2,"div")(3,"span",15),r(4,"Referencia"),n(),t(5,"span",16),r(6),n()()()),a&2){let e=d(2);l(6),P(e.trabajo.idServicio==null||e.trabajo.idServicio.ubicacion==null?null:e.trabajo.idServicio.ubicacion.referencia)}}function Ve(a,p){a&1&&(t(0,"ion-chip",23),c(1,"ion-icon",28),t(2,"ion-label"),r(3,"Garant\xEDa de Satisfacci\xF3n Activa"),n()())}function ze(a,p){a&1&&(t(0,"span",34),c(1,"ion-icon",28),r(2," Verificado "),n())}function Ae(a,p){if(a&1){let e=C();t(0,"ion-card",29),b("click",function(){_(e);let i=d(2);return g(i.verPerfil(i.trabajo.idTecnico._id))}),t(1,"ion-card-header")(2,"ion-card-title"),r(3,"T\xE9cnico Asignado"),n()(),t(4,"ion-card-content")(5,"div",30)(6,"ion-avatar"),c(7,"img",31),n(),t(8,"div",32)(9,"div",33)(10,"h4"),r(11),n(),f(12,ze,3,0,"span",34),n(),t(13,"div",35),c(14,"ion-icon",36),t(15,"span"),r(16),n(),t(17,"span",37),r(18),n()()(),t(19,"div",38)(20,"ion-button",39),b("click",function(i){_(e);let s=d(2);return g(s.llamar(s.trabajo.idTecnico.perfil==null?null:s.trabajo.idTecnico.perfil.telefono,i))}),c(21,"ion-icon",40),n(),t(22,"ion-button",39),b("click",function(i){_(e);let s=d(2);return g(s.abrirChat(i))}),c(23,"ion-icon",41),n()()()()()}if(a&2){let e=d(2);l(7),h("src",(e.trabajo.idTecnico.perfil==null?null:e.trabajo.idTecnico.perfil.fotoUrl)||"assets/avatar-default.png",w),l(4),T("",e.trabajo.idTecnico.perfil==null?null:e.trabajo.idTecnico.perfil.nombre," ",e.trabajo.idTecnico.perfil==null?null:e.trabajo.idTecnico.perfil.apellido,""),l(),u(e.trabajo.idTecnico.datosTecnico!=null&&e.trabajo.idTecnico.datosTecnico.verificado?12:-1),l(4),P((e.trabajo.idTecnico.datosTecnico==null||e.trabajo.idTecnico.datosTecnico.calificacion==null?null:e.trabajo.idTecnico.datosTecnico.calificacion.toFixed(1))||"Sin calif."),l(2),O("\xB7 ",(e.trabajo.idTecnico.datosTecnico==null?null:e.trabajo.idTecnico.datosTecnico.trabajosCompletados)||0," trabajos"),l(2),h("disabled",e.trabajo.estado==="completado"||e.trabajo.estado==="cancelado"),l(2),h("disabled",e.trabajo.estado==="completado"||e.trabajo.estado==="cancelado")}}function Re(a,p){if(a&1){let e=C();t(0,"ion-card",24)(1,"ion-card-header")(2,"ion-card-title"),r(3,"Cliente"),n()(),t(4,"ion-card-content")(5,"div",30)(6,"ion-avatar"),c(7,"img",31),n(),t(8,"div",32)(9,"h4"),r(10),n()(),t(11,"div",38)(12,"ion-button",39),b("click",function(i){_(e);let s=d(2);return g(s.llamar(s.trabajo.idCliente.perfil==null?null:s.trabajo.idCliente.perfil.telefono,i))}),c(13,"ion-icon",40),n(),t(14,"ion-button",39),b("click",function(i){_(e);let s=d(2);return g(s.abrirChat(i))}),c(15,"ion-icon",41),n()()()()()}if(a&2){let e=d(2);l(7),h("src",(e.trabajo.idCliente.perfil==null?null:e.trabajo.idCliente.perfil.fotoUrl)||"assets/avatar-default.png",w),l(3),T("",e.trabajo.idCliente.perfil==null?null:e.trabajo.idCliente.perfil.nombre," ",e.trabajo.idCliente.perfil==null?null:e.trabajo.idCliente.perfil.apellido,""),l(2),h("disabled",e.trabajo.estado==="completado"||e.trabajo.estado==="cancelado"),l(2),h("disabled",e.trabajo.estado==="completado"||e.trabajo.estado==="cancelado")}}function qe(a,p){if(a&1){let e=C();t(0,"ion-button",43),b("click",function(){_(e);let i=d(3);return g(i.cambiarEstado("en_camino"))}),c(1,"ion-icon",44),r(2," Estoy en Camino "),n()}}function Be(a,p){if(a&1){let e=C();t(0,"ion-button",43),b("click",function(){_(e);let i=d(3);return g(i.cambiarEstado("en_progreso"))}),c(1,"ion-icon",45),r(2," Llegu\xE9 - Iniciar Trabajo "),n()}}function Ue(a,p){if(a&1){let e=C();t(0,"div",51),c(1,"img",55),t(2,"ion-icon",56),b("click",function(){let i=_(e).$index,s=d(4);return g(s.eliminarFoto(i))}),n()()}if(a&2){let e=p.$implicit;l(),h("src",e,w)}}function $e(a,p){if(a&1){let e=C();t(0,"div",57),b("click",function(){_(e);let i=d(4);return g(i.agregarFotoDirecta())}),c(1,"ion-icon",58),n()}}function Le(a,p){if(a&1){let e=C();t(0,"ion-button",59),b("click",function(){_(e);let i=d(4);return g(i.confirmarSubidaFotos())}),c(1,"ion-icon",60),r(2),n()}if(a&2){let e=d(4);l(2),O(" Subir ",e.fotosPreview.length," foto(s) ")}}function Ne(a,p){a&1&&(t(0,"p",54),r(1," \u2705 Fotos subidas correctamente "),n())}function He(a,p){if(a&1){let e=C();t(0,"ion-button",46),b("click",function(){_(e);let i=d(3);return g(i.cambiarEstado("completado"))}),c(1,"ion-icon",47),r(2," Marcar como Completado "),n(),t(3,"div",48)(4,"p",49),r(5,"\u{1F4F7} Fotos del trabajo (opcional, m\xE1x. 5)"),n(),t(6,"div",50),y(7,Ue,3,1,"div",51,E),f(9,$e,2,0,"div",52),n(),f(10,Le,3,1,"ion-button",53)(11,Ne,2,0,"p",54),n()}if(a&2){let e=d(3);l(7),k(e.fotosPreview),l(2),u(e.fotosPreview.length<5?9:-1),l(),u(e.fotosPreview.length>0&&!e.fotosCargadas?10:-1),l(),u(e.fotosCargadas?11:-1)}}function Ge(a,p){if(a&1){let e=C();t(0,"p",61),r(1," \u23F3 Esperando aprobaci\xF3n del cliente... "),n(),t(2,"ion-button",62),b("click",function(){_(e);let i=d(3);return g(i.iniciarDisputa())}),c(3,"ion-icon",63),r(4," Iniciar Disputa "),n()}}function Je(a,p){if(a&1&&(t(0,"ion-card",25)(1,"ion-card-header")(2,"ion-card-title"),r(3,"Actualizar Estado"),n()(),t(4,"ion-card-content"),f(5,qe,3,0,"ion-button",42)(6,Be,3,0,"ion-button",42)(7,He,12,3)(8,Ge,5,0),n()()),a&2){let e=d(2);l(5),u(e.trabajo.estado==="programado"?5:-1),l(),u(e.trabajo.estado==="en_camino"?6:-1),l(),u(e.trabajo.estado==="en_progreso"?7:-1),l(),u(e.trabajo.estado==="completado"&&(e.trabajo.pago==null?null:e.trabajo.pago.estado)!=="liberado"?8:-1)}}function Ke(a,p){if(a&1){let e=C();t(0,"ion-card",26)(1,"ion-card-header")(2,"ion-card-title"),r(3,"\xBFApruebas el trabajo?"),n(),t(4,"ion-card-subtitle"),r(5,"Al aprobar, el pago ser\xE1 liberado al t\xE9cnico"),n()(),t(6,"ion-card-content")(7,"ion-button",46),b("click",function(){_(e);let i=d(2);return g(i.aprobarTrabajo())}),c(8,"ion-icon",64),r(9," Aprobar Trabajo "),n(),t(10,"ion-button",65),b("click",function(){_(e);let i=d(2);return g(i.reportarProblema())}),c(11,"ion-icon",63),r(12," Reportar Problema "),n()()()}}function Qe(a,p){if(a&1){let e=C();t(0,"ion-card",68)(1,"ion-card-content")(2,"div",69),c(3,"ion-icon",36),t(4,"div",70)(5,"h4"),r(6,"\xBFC\xF3mo fue tu experiencia?"),n(),t(7,"p"),r(8,"Tu opini\xF3n ayuda a otros usuarios"),n()()(),t(9,"ion-button",71),b("click",function(){_(e);let i=d(3);return g(i.dejarResena())}),c(10,"ion-icon",72),r(11," Calificar Servicio "),n()()()}}function We(a,p){if(a&1){let e=C();t(0,"ion-card",68)(1,"ion-card-content")(2,"div",69),c(3,"ion-icon",36),t(4,"div",70)(5,"h4"),r(6,"\xBFC\xF3mo fue el cliente?"),n(),t(7,"p"),r(8,"Califica tu experiencia con este cliente"),n()()(),t(9,"ion-button",71),b("click",function(){_(e);let i=d(3);return g(i.dejarResenaAlCliente())}),c(10,"ion-icon",72),r(11," Calificar Cliente "),n()()()}}function Xe(a,p){if(a&1&&(t(0,"ion-card",66)(1,"ion-card-content")(2,"div",67),c(3,"ion-icon",7),t(4,"h3"),r(5,"Trabajo Aprobado"),n(),t(6,"p"),r(7,"El pago ha sido liberado al t\xE9cnico"),n()()()(),f(8,Qe,12,0,"ion-card",68)(9,We,12,0,"ion-card",68)),a&2){let e=d(2);l(8),u(e.esCliente&&!e.trabajo.resenaCliente?8:-1),l(),u(e.esTecnico&&!e.trabajo.resenaTecnico?9:-1)}}function Ye(a,p){if(a&1&&(t(0,"ion-card",3)(1,"ion-card-header")(2,"ion-card-title"),r(3,"Estado del Trabajo"),n()(),t(4,"ion-card-content")(5,"div",4)(6,"div",5)(7,"div",6),c(8,"ion-icon",7),n(),t(9,"span"),r(10,"Aceptado"),n()(),c(11,"div",8),t(12,"div",5)(13,"div",6),c(14,"ion-icon",9),n(),t(15,"span"),r(16,"En Camino"),n()(),c(17,"div",8),t(18,"div",5)(19,"div",6),c(20,"ion-icon",10),n(),t(21,"span"),r(22,"En Progreso"),n()(),c(23,"div",8),t(24,"div",5)(25,"div",6),c(26,"ion-icon",11),n(),t(27,"span"),r(28,"Completado"),n()()()()(),t(29,"ion-card")(30,"ion-card-header")(31,"ion-card-subtitle"),r(32),n(),t(33,"ion-card-title"),r(34),n()(),t(35,"ion-card-content")(36,"p"),r(37),n(),t(38,"div",12)(39,"div",13),c(40,"ion-icon",14),t(41,"div")(42,"span",15),r(43,"Ubicaci\xF3n"),n(),t(44,"span",16),r(45),n()()(),f(46,Fe,7,1,"div",13),t(47,"div",13),c(48,"ion-icon",17),t(49,"div")(50,"span",15),r(51,"Fecha Programada"),n(),t(52,"span",16),r(53),I(54,"date"),n()()()()()(),t(55,"ion-card")(56,"ion-card-header")(57,"ion-card-title"),c(58,"ion-icon",18),r(59," Informaci\xF3n de Pago "),n()(),t(60,"ion-card-content")(61,"div",19)(62,"div",20)(63,"span",15),r(64,"Monto Total"),n(),t(65,"span",21),r(66),n()(),t(67,"div",20)(68,"span",15),r(69,"Estado del Pago"),n(),t(70,"ion-badge",22),r(71),n()()(),f(72,Ve,4,0,"ion-chip",23),n()(),f(73,Ae,24,8,"ion-card",24)(74,Re,16,5,"ion-card",24)(75,Je,9,4,"ion-card",25)(76,Ke,13,0,"ion-card",26)(77,Xe,10,2)),a&2){let e=d();l(6),v("active",e.estaEnEstado("programado"))("completado",e.estadoPasado("programado")),l(5),v("active",e.estadoPasado("programado")),l(),v("active",e.estaEnEstado("en_camino"))("completado",e.estadoPasado("en_camino")),l(5),v("active",e.estadoPasado("en_camino")),l(),v("active",e.estaEnEstado("en_progreso"))("completado",e.estadoPasado("en_progreso")),l(5),v("active",e.estadoPasado("en_progreso")),l(),v("active",e.estaEnEstado("completado"))("completado",e.estadoPasado("completado")),l(8),P(e.obtenerEtiquetaTipo(e.trabajo.idServicio==null?null:e.trabajo.idServicio.tipo)),l(2),P((e.trabajo.idServicio==null?null:e.trabajo.idServicio.titulo)||"Servicio"),l(3),P(e.trabajo.idServicio==null?null:e.trabajo.idServicio.descripcion),l(8),P((e.trabajo.idServicio==null||e.trabajo.idServicio.ubicacion==null?null:e.trabajo.idServicio.ubicacion.direccion)||"Sin ubicaci\xF3n"),l(),u(!(e.trabajo.idServicio==null||e.trabajo.idServicio.ubicacion==null)&&e.trabajo.idServicio.ubicacion.referencia?46:-1),l(7),P(F(54,37,e.trabajo.fechaProgramada,"dd/MM/yyyy HH:mm")),l(13),O("$",(e.trabajo.pago==null||e.trabajo.pago.monto==null?null:e.trabajo.pago.monto.toFixed(2))||"0.00",""),l(4),h("color",e.obtenerColorPago(e.trabajo.pago==null?null:e.trabajo.pago.estado)),l(),O(" ",e.obtenerEtiquetaPago(e.trabajo.pago==null?null:e.trabajo.pago.estado)," "),l(),u(e.trabajo.pago!=null&&e.trabajo.pago.tieneGarantia?72:-1),l(),u(e.esCliente&&e.trabajo.idTecnico?73:-1),l(),u(e.esTecnico&&e.trabajo.idCliente?74:-1),l(),u(e.esTecnico&&e.trabajo.estado!=="completado"&&e.trabajo.estado!=="cancelado"?75:-1),l(),u(e.esCliente&&e.trabajo.estado==="completado"&&(e.trabajo.pago==null?null:e.trabajo.pago.estado)!=="liberado"?76:-1),l(),u((e.trabajo.pago==null?null:e.trabajo.pago.estado)==="liberado"?77:-1)}}var ht=(()=>{class a{constructor(){this.route=x(z),this.router=x(A),this.trabajosServicio=x(ye),this.authServicio=x(ae),this.socketServicio=x(ke),this.alertController=x(te),this.toastController=x(ie),this.loadingController=x(ne),this.trabajo=null,this.cargando=!0,this.esCliente=!1,this.esTecnico=!1,this.trabajoId="",this.fotosPreview=[],this.archivosSeleccionados=[],this.mostrandoPreviewFotos=!1,this.fotosCargadas=!1,this.subscriptions=[],this.ordenEstados=["programado","en_camino","en_progreso","completado"],re({locationOutline:xe,calendarOutline:ce,timeOutline:Me,personOutline:ve,callOutline:se,chatbubbleOutline:ue,starOutline:Oe,star:je,flashOutline:fe,checkmarkCircleOutline:_e,carOutline:me,constructOutline:Ce,shieldCheckmarkOutline:Pe,cashOutline:pe,warningOutline:Se,thumbsUpOutline:Te,thumbsDownOutline:we,cameraOutline:de,navigateOutline:he,closeCircle:ge,addOutline:le,cloudUploadOutline:be})}ngOnInit(){this.trabajoId=this.route.snapshot.paramMap.get("id")||"",this.esCliente=this.authServicio.esCliente(),this.esTecnico=this.authServicio.esTecnico(),this.cargarTrabajo(),this.escucharActualizaciones()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}cargarTrabajo(){this.cargando=!0,this.trabajosServicio.obtenerTrabajo(this.trabajoId).subscribe({next:e=>{this.cargando=!1,e.datos&&(this.trabajo=e.datos.trabajo||e.datos)},error:()=>m(this,null,function*(){this.cargando=!1,yield(yield this.toastController.create({message:"Error al cargar el trabajo",duration:3e3,color:"danger"})).present()})})}escucharActualizaciones(){let e=this.socketServicio.notificacion$.subscribe(o=>{let i=["estado_actualizado","trabajo_estado_actualizado"],s=o.datos?.idTrabajo||o.datos?.trabajoId;if(i.includes(o.tipo)&&s===this.trabajoId){console.log("\u{1F504} Actualizaci\xF3n de estado recibida:",o.datos);let j=o.datos?.nuevoEstado||o.datos?.estadoNuevo;this.trabajo&&j&&(this.trabajo.estado=j),this.cargarTrabajo()}});this.subscriptions.push(e)}estaEnEstado(e){return this.trabajo?.estado===e}estadoPasado(e){if(!this.trabajo)return!1;let o=this.ordenEstados.indexOf(this.trabajo.estado),i=this.ordenEstados.indexOf(e);return o>i}cambiarEstado(e){return m(this,null,function*(){let o=yield this.loadingController.create({message:"Actualizando estado..."});yield o.present(),this.trabajosServicio.actualizarEstado(this.trabajoId,e).subscribe({next:i=>m(this,null,function*(){yield o.dismiss(),this.trabajo&&(this.trabajo.estado=e),yield(yield this.toastController.create({message:this.obtenerMensajeEstado(e),duration:3e3,color:"success"})).present()}),error:i=>m(this,null,function*(){yield o.dismiss(),yield(yield this.toastController.create({message:i.error?.mensaje||"Error al actualizar estado",duration:3e3,color:"danger"})).present()})})})}obtenerMensajeEstado(e){return{en_camino:"\u{1F697} \xA1En camino! El cliente ha sido notificado",en_progreso:"\u{1F527} Trabajo iniciado",completado:"\u2705 Trabajo marcado como completado"}[e]||"Estado actualizado"}aprobarTrabajo(){return m(this,null,function*(){yield(yield this.alertController.create({header:"Aprobar Trabajo",message:"\xBFEst\xE1s satisfecho con el servicio? El pago ser\xE1 liberado al t\xE9cnico.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Aprobar",handler:()=>m(this,null,function*(){yield this.procesarAprobacion()})}]})).present()})}procesarAprobacion(){return m(this,null,function*(){let e=yield this.loadingController.create({message:"Liberando pago..."});yield e.present(),this.trabajosServicio.aprobarTrabajo(this.trabajoId).subscribe({next:o=>m(this,null,function*(){yield e.dismiss(),this.trabajo?.pago&&(this.trabajo.pago.estado="liberado");let i=o.datos?.puntosGanados||0;yield(yield this.alertController.create({header:"\u{1F389} \xA1Trabajo Aprobado!",message:i>0?`El pago ha sido liberado al t\xE9cnico. \u{1F381} \xA1Has ganado ${i} puntos de fidelidad! \xBFTe gustar\xEDa dejar una rese\xF1a?`:"El pago ha sido liberado al t\xE9cnico. \xBFTe gustar\xEDa dejar una rese\xF1a?",buttons:[{text:"M\xE1s tarde",role:"cancel"},{text:"Dejar Rese\xF1a",handler:()=>{this.dejarResena()}}]})).present()}),error:o=>m(this,null,function*(){yield e.dismiss(),yield(yield this.toastController.create({message:o.error?.mensaje||"Error al aprobar trabajo",duration:3e3,color:"danger"})).present()})})})}reportarProblema(){return m(this,null,function*(){yield this.iniciarDisputa()})}dejarResena(){this.router.navigate(["/nueva-resena",this.trabajoId])}dejarResenaAlCliente(){this.router.navigate(["/nueva-resena",this.trabajoId],{queryParams:{tipo:"cliente"}})}subirFotos(){return m(this,null,function*(){yield(yield this.alertController.create({header:"\u{1F4F7} Subir Fotos del Trabajo",message:"Aseg\xFArate de subir fotos del trabajo realizado como evidencia en caso de disputa.",cssClass:"alert-subir-fotos",buttons:[{text:"Cancelar",role:"cancel"},{text:"Seleccionar Fotos",handler:()=>{this.seleccionarArchivos()}}]})).present()})}seleccionarArchivos(){let e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.onchange=o=>{let i=o.target.files;i&&i.length>0&&this.agregarFotosAlPreview(i)},e.click()}agregarFotosAlPreview(e){let o=5-this.fotosPreview.length,i=Math.min(e.length,o);for(let s=0;s<i;s++){let j=e[s];this.archivosSeleccionados.push(j);let M=new FileReader;M.onload=De=>{this.fotosPreview.push(De.target.result)},M.readAsDataURL(j)}this.mostrandoPreviewFotos=!0,e.length>o&&this.toastController.create({message:"Solo se pueden subir m\xE1ximo 5 fotos",duration:2e3,color:"warning"}).then(s=>s.present())}agregarMasFotos(){this.seleccionarArchivos()}agregarFotoDirecta(){this.seleccionarArchivos()}eliminarFoto(e){this.fotosPreview.splice(e,1),this.archivosSeleccionados.splice(e,1),this.fotosPreview.length===0&&(this.mostrandoPreviewFotos=!1)}cancelarFotos(){this.fotosPreview=[],this.archivosSeleccionados=[],this.mostrandoPreviewFotos=!1}confirmarSubidaFotos(){return m(this,null,function*(){if(this.archivosSeleccionados.length===0){yield(yield this.toastController.create({message:"No hay fotos seleccionadas",duration:2e3,color:"warning"})).present();return}let e=yield this.loadingController.create({message:"Subiendo fotos...",spinner:"crescent"});yield e.present();let o=new FormData;for(let i of this.archivosSeleccionados)o.append("fotos",i);this.trabajosServicio.subirFotosDespues(this.trabajoId,o).subscribe({next:()=>m(this,null,function*(){yield e.dismiss();let i=this.archivosSeleccionados.length;this.fotosCargadas=!0,this.fotosPreview=[],this.archivosSeleccionados=[],this.mostrandoPreviewFotos=!1,yield(yield this.toastController.create({message:`\u2705 ${i} foto(s) subida(s) exitosamente`,duration:3e3,color:"success",position:"top"})).present(),this.cargarTrabajo()}),error:i=>m(this,null,function*(){yield e.dismiss(),yield(yield this.toastController.create({message:i.error?.mensaje||"Error al subir fotos",duration:3e3,color:"danger",position:"top"})).present()})})})}iniciarDisputa(){return m(this,null,function*(){yield(yield this.alertController.create({header:"\u26A0\uFE0F Iniciar Disputa",message:"Una disputa ser\xE1 revisada por nuestro equipo de soporte. Describe el problema claramente.",inputs:[{name:"tipo",type:"radio",label:"\u{1F527} Calidad del trabajo",value:"calidad",checked:!0},{name:"tipo",type:"radio",label:"\u23F1\uFE0F Problema de tiempo",value:"tiempo"},{name:"tipo",type:"radio",label:"\u{1F4B0} Problema de precio",value:"precio"},{name:"tipo",type:"radio",label:"\u{1F464} Comportamiento",value:"comportamiento"},{name:"tipo",type:"radio",label:"\u{1F4CB} Otro",value:"otro"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Siguiente",handler:o=>{this.mostrarFormularioDisputa(o)}}]})).present()})}mostrarFormularioDisputa(e){return m(this,null,function*(){yield(yield this.alertController.create({header:"Describe el problema",inputs:[{name:"motivo",type:"textarea",placeholder:"Explica detalladamente el problema...",attributes:{rows:4}}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Enviar Disputa",handler:i=>m(this,null,function*(){return!i.motivo||i.motivo.trim().length<10?(yield(yield this.toastController.create({message:"Por favor describe el problema con m\xE1s detalle",duration:2e3,color:"warning"})).present(),!1):(this.enviarDisputa(e,i.motivo),!0)})}]})).present()})}enviarDisputa(e,o){return m(this,null,function*(){let i=yield this.loadingController.create({message:"Enviando disputa..."});yield i.present(),this.trabajosServicio.crearDisputa(this.trabajoId,{tipo:e,motivo:o}).subscribe({next:()=>m(this,null,function*(){yield i.dismiss(),yield(yield this.alertController.create({header:"\u2705 Disputa Enviada",message:`Tu disputa ha sido registrada. Nuestro equipo de soporte la revisar\xE1 en las pr\xF3ximas 24-48 horas y te contactar\xE1n para resolver el problema.

Mientras tanto, el pago quedar\xE1 retenido hasta que se resuelva la situaci\xF3n.`,buttons:["Entendido"]})).present(),this.cargarTrabajo()}),error:s=>m(this,null,function*(){yield i.dismiss(),yield(yield this.toastController.create({message:s.error?.mensaje||"Error al enviar disputa",duration:3e3,color:"danger"})).present()})})})}llamar(e,o){o.stopPropagation(),e&&(window.location.href=`tel:${e}`)}abrirChat(e){e.stopPropagation();let o="";this.esCliente&&this.trabajo?.idTecnico?o=this.trabajo.idTecnico._id||this.trabajo.idTecnico:this.esTecnico&&this.trabajo?.idCliente&&(o=this.trabajo.idCliente._id||this.trabajo.idCliente),o&&this.router.navigate(["/chat",o],{queryParams:{trabajoId:this.trabajoId}})}verPerfil(e){this.router.navigate(["/perfil-tecnico",e])}obtenerEtiquetaTipo(e){return e?Ee.find(i=>i.valor===e)?.etiqueta||e:"Servicio"}obtenerColorPago(e){return{pendiente:"warning",retenido:"tertiary",liberado:"success",reembolsado:"medium",parcial:"warning"}[e||""]||"medium"}obtenerEtiquetaPago(e){return{pendiente:"Pendiente",retenido:"Retenido (Garant\xEDa)",liberado:"Liberado",reembolsado:"Reembolsado",parcial:"Parcialmente liberado"}[e||""]||e||"Pendiente"}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275cmp=S({type:a,selectors:[["app-detalle-trabajo"]],standalone:!0,features:[D],decls:9,vars:1,consts:[["slot","start"],["defaultHref","/tabs/trabajos"],[1,"loading-container"],[1,"timeline-card"],[1,"timeline"],[1,"timeline-item"],[1,"timeline-icon"],["name","checkmark-circle-outline"],[1,"timeline-line"],["name","car-outline"],["name","construct-outline"],["name","star-outline"],[1,"info-grid"],[1,"info-item"],["name","location-outline","color","primary"],[1,"label"],[1,"value"],["name","calendar-outline","color","primary"],["name","cash-outline"],[1,"pago-grid"],[1,"pago-item"],[1,"monto"],[3,"color"],["color","success"],[1,"persona-card"],[1,"acciones-card"],[1,"acciones-card","cliente-acciones"],["name","navigate-outline","color","primary"],["name","shield-checkmark-outline"],[1,"persona-card",3,"click"],[1,"persona-info"],["alt","",3,"src"],[1,"persona-datos"],[1,"nombre-row"],[1,"badge-tecnico-verificado"],[1,"calificacion"],["name","star","color","warning"],[1,"trabajos"],[1,"persona-acciones"],["fill","clear",3,"click","disabled"],["name","call-outline"],["name","chatbubble-outline"],["expand","block"],["expand","block",3,"click"],["name","car-outline","slot","start"],["name","construct-outline","slot","start"],["expand","block","color","success",3,"click"],["name","checkmark-circle-outline","slot","start"],[1,"fotos-trabajo-section","ion-margin-top"],[1,"fotos-titulo"],[1,"fotos-grid"],[1,"foto-item"],[1,"foto-agregar"],["expand","block","color","success",1,"ion-margin-top"],[1,"fotos-subidas-exito","ion-text-center","ion-margin-top"],["alt","Foto del trabajo",3,"src"],["name","close-circle",1,"btn-eliminar",3,"click"],[1,"foto-agregar",3,"click"],["name","add-outline"],["expand","block","color","success",1,"ion-margin-top",3,"click"],["name","cloud-upload-outline","slot","start"],[1,"texto-espera","ion-text-center","ion-margin-top"],["expand","block","fill","outline","color","warning",1,"ion-margin-top",3,"click"],["name","warning-outline","slot","start"],["name","thumbs-up-outline","slot","start"],["expand","block","fill","outline","color","danger",1,"ion-margin-top",3,"click"],[1,"exito-card"],[1,"exito-content"],[1,"resena-card"],[1,"resena-prompt"],[1,"resena-texto"],["color","primary","size","default",3,"click"],["name","star-outline","slot","start"]],template:function(o,i){o&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),c(3,"ion-back-button",1),n(),t(4,"ion-title"),r(5,"Detalle del Trabajo"),n()()(),t(6,"ion-content"),f(7,Ie,4,0,"div",2)(8,Ye,78,40),n()),o&2&&(l(7),u(i.cargando?7:i.trabajo?8:-1))},dependencies:[Q,W,ee,Z,$,R,L,N,H,J,G,U,oe,Y,q,K,X,B,V],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 16px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}.timeline-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:16px}.timeline[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 0}.timeline-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;opacity:.4}.timeline-item[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--ion-color-light);display:flex;align-items:center;justify-content:center;border:2px solid var(--ion-color-light)}.timeline-item[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:var(--ion-color-medium)}.timeline-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10px;text-align:center;color:var(--ion-color-medium)}.timeline-item.active[_ngcontent-%COMP%]{opacity:1}.timeline-item.active[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]{background:var(--ion-color-success);border-color:var(--ion-color-success)}.timeline-item.active[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.timeline-item.active[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:600}.timeline-item.completado[_ngcontent-%COMP%]{opacity:1}.timeline-item.completado[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]{background:var(--ion-color-success);border-color:var(--ion-color-success)}.timeline-item.completado[_ngcontent-%COMP%]   .timeline-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff}.timeline-item.completado[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:600}.timeline-line[_ngcontent-%COMP%]{flex:1;height:4px;background:var(--ion-color-light);margin:0 4px;border-radius:2px}.timeline-line.active[_ngcontent-%COMP%]{background:var(--ion-color-success)}.info-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-top:16px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px}.info-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;margin-top:2px}.info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:12px;color:var(--ion-color-medium)}.info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500}.pago-grid[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:16px}.pago-grid[_ngcontent-%COMP%]   .pago-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:12px;color:var(--ion-color-medium);margin-bottom:4px}.pago-grid[_ngcontent-%COMP%]   .pago-item[_ngcontent-%COMP%]   .monto[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--ion-color-primary)}.persona-card[_ngcontent-%COMP%]{cursor:pointer}.persona-card[_ngcontent-%COMP%]:active{opacity:.8}.persona-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.persona-info[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:56px;height:56px}.persona-info[_ngcontent-%COMP%]   .persona-datos[_ngcontent-%COMP%]{flex:1}.persona-info[_ngcontent-%COMP%]   .persona-datos[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600}.persona-info[_ngcontent-%COMP%]   .persona-datos[_ngcontent-%COMP%]   .calificacion[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:14px;color:var(--ion-color-medium)}.persona-info[_ngcontent-%COMP%]   .persona-datos[_ngcontent-%COMP%]   .calificacion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.persona-info[_ngcontent-%COMP%]   .persona-datos[_ngcontent-%COMP%]   .calificacion[_ngcontent-%COMP%]   .trabajos[_ngcontent-%COMP%]{font-size:12px}.persona-info[_ngcontent-%COMP%]   .persona-acciones[_ngcontent-%COMP%]{display:flex;gap:4px}.acciones-card[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px}.cliente-acciones[_ngcontent-%COMP%]{border:2px solid var(--ion-color-warning);border-radius:12px}.texto-espera[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px;margin:12px 0}.fotos-preview-container[_ngcontent-%COMP%]{padding:12px;background:var(--ion-color-light);border-radius:12px;margin-top:16px}.fotos-preview-container[_ngcontent-%COMP%]   .fotos-titulo[_ngcontent-%COMP%]{font-weight:600;font-size:14px;margin:0 0 12px;color:var(--ion-text-color)}.fotos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}.foto-item[_ngcontent-%COMP%]{position:relative;aspect-ratio:1;border-radius:8px;overflow:hidden}.foto-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.foto-item[_ngcontent-%COMP%]   .btn-eliminar[_ngcontent-%COMP%]{position:absolute;top:4px;right:4px;font-size:24px;color:var(--ion-color-danger);background:#fff;border-radius:50%;cursor:pointer}.foto-agregar[_ngcontent-%COMP%]{aspect-ratio:1;border:2px dashed var(--ion-color-medium);border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;color:var(--ion-color-medium)}.foto-agregar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px}.foto-agregar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px;margin-top:2px}.foto-agregar[_ngcontent-%COMP%]:active{background:var(--ion-color-light-shade)}.fotos-acciones[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.fotos-trabajo-section[_ngcontent-%COMP%]{background:var(--ion-color-light);border-radius:12px;padding:16px;margin-top:16px}.fotos-trabajo-section[_ngcontent-%COMP%]   .fotos-titulo[_ngcontent-%COMP%]{font-weight:600;font-size:14px;margin:0 0 12px;color:var(--ion-text-color)}.fotos-subidas-exito[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:500;font-size:14px}.exito-card[_ngcontent-%COMP%]{text-align:center;background:var(--ion-color-success)}.exito-card[_ngcontent-%COMP%]   .exito-content[_ngcontent-%COMP%]{padding:24px 16px}.exito-card[_ngcontent-%COMP%]   .exito-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:#fff}.exito-card[_ngcontent-%COMP%]   .exito-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;color:#fff;font-weight:600}.exito-card[_ngcontent-%COMP%]   .exito-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#ffffffe6;margin-bottom:0}.resena-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px}.resena-card[_ngcontent-%COMP%]   .resena-prompt[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.resena-card[_ngcontent-%COMP%]   .resena-prompt[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:32px}.resena-card[_ngcontent-%COMP%]   .resena-prompt[_ngcontent-%COMP%]   .resena-texto[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600}.resena-card[_ngcontent-%COMP%]   .resena-prompt[_ngcontent-%COMP%]   .resena-texto[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:13px;color:var(--ion-color-medium)}.resena-card[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;width:100%}"]})}}return a})();export{ht as DetalleTrabajoPage};
