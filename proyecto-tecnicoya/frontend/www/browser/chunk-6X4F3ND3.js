import{a as Te}from"./chunk-RER3LUMB.js";import{a as Oe}from"./chunk-WXOXMQ3X.js";import{Da as ve,K as Ce,M as xe,R as je,_ as he,a as de,e as me,ga as Pe,h as pe,i as _e,ka as Me,m as ue,n as ge,p as be,s as fe}from"./chunk-TI2PQS3J.js";import"./chunk-JQ3F7U5Y.js";import{$ as B,A as S,Aa as N,B as t,C as i,D as d,E as x,Ea as L,F as _,Fa as H,G as m,Ga as U,Ha as W,Ia as G,Ja as J,K as r,Ka as K,L as b,M as E,Ma as Q,N as y,Na as X,O as I,Oa as Y,P as w,Q as k,R as F,Sa as Z,T as P,V,X as z,Ya as ee,Z as q,Za as te,ab as ne,bb as ie,cb as oe,eb as ae,ia as R,ib as re,j,jb as le,k as v,l as u,m as g,n as O,o as l,oa as $,qa as D,r as h,s as f,sb as ce,vb as se,w as C,wa as A,z as T}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as M}from"./chunk-B4AJQJMI.js";var Se=(o,p)=>p._id;function Ee(o,p){o&1&&(t(0,"div",8),d(1,"ion-spinner"),t(2,"p"),r(3,"Cargando trabajos..."),i()())}function ye(o,p){o&1&&(t(0,"div",9),d(1,"ion-icon",11),t(2,"h3"),r(3,"No tienes trabajos"),i(),t(4,"p"),r(5,"Cuando acepten tus cotizaciones, los trabajos aparecer\xE1n aqu\xED"),i()())}function Ie(o,p){if(o&1){let e=x();t(0,"div",32)(1,"ion-button",33),_("click",function(a){u(e);let c=m().$implicit,s=m(2);return g(s.iniciarCamino(c._id,a))}),d(2,"ion-icon",34),r(3," Iniciar Camino "),i()()}}function we(o,p){if(o&1){let e=x();t(0,"div",32)(1,"ion-button",33),_("click",function(a){u(e);let c=m().$implicit,s=m(2);return g(s.iniciarTrabajo(c._id,a))}),d(2,"ion-icon",35),r(3," Llegu\xE9 - Iniciar Trabajo "),i()()}}function ke(o,p){if(o&1){let e=x();t(0,"div",32)(1,"ion-button",36),_("click",function(a){u(e);let c=m().$implicit,s=m(2);return g(s.completarTrabajo(c._id,a))}),d(2,"ion-icon",37),r(3," Marcar Completado "),i()()}}function Fe(o,p){if(o&1){let e=x();t(0,"ion-card",13),_("click",function(){let a=u(e).$implicit,c=m(2);return g(c.verTrabajo(a._id))}),t(1,"ion-card-header")(2,"div",14)(3,"ion-chip",15)(4,"ion-label"),r(5),i()(),t(6,"ion-badge",16),r(7),i()(),t(8,"ion-card-title"),r(9),i()(),t(10,"ion-card-content")(11,"div",17)(12,"ion-avatar"),d(13,"img",18),i(),t(14,"div",19)(15,"span",20),r(16),i(),t(17,"span",21),d(18,"ion-icon",22),t(19,"span",23),r(20),i()()(),t(21,"div",24)(22,"ion-button",25),_("click",function(a){let c=u(e).$implicit,s=m(2);return g(s.llamar(c.idCliente==null||c.idCliente.perfil==null?null:c.idCliente.perfil.telefono,a))}),d(23,"ion-icon",26),i(),t(24,"ion-button",25),_("click",function(a){let c=u(e).$implicit,s=m(2);return g(s.abrirChat(c.idCliente==null?null:c.idCliente._id,a))}),d(25,"ion-icon",27),i()()(),t(26,"div",28)(27,"div",29),d(28,"ion-icon",30),t(29,"span"),r(30),P(31,"date"),i()(),t(32,"div",29),d(33,"ion-icon",31),t(34,"span"),r(35),P(36,"currency"),i()()(),h(37,Ie,4,0,"div",32)(38,we,4,0,"div",32)(39,ke,4,0,"div",32),i()()}if(o&2){let e=p.$implicit,n=m(2);l(5),b(n.obtenerEtiquetaTipo((e.idServicio==null?null:e.idServicio.tipo)||"")),l(),f("color",n.obtenerColorEstado(e.estado)),l(),E(" ",n.obtenerEtiquetaEstado(e.estado)," "),l(2),b(e.idServicio==null?null:e.idServicio.titulo),l(4),f("src",(e.idCliente==null||e.idCliente.perfil==null?null:e.idCliente.perfil.fotoUrl)||"assets/avatar-default.png",O),l(3),y("",e.idCliente==null||e.idCliente.perfil==null?null:e.idCliente.perfil.nombre," ",e.idCliente==null||e.idCliente.perfil==null?null:e.idCliente.perfil.apellido,""),l(4),b(e.idServicio==null||e.idServicio.ubicacion==null?null:e.idServicio.ubicacion.direccion),l(2),f("disabled",e.estado==="completado"||e.estado==="programado"),l(2),f("disabled",e.estado==="completado"||e.estado==="programado"),l(6),b(V(31,15,e.fechaProgramada||e.fechaInicio,"dd/MM/yyyy")),l(5),b(z(36,18,(e.pago==null?null:e.pago.monto)||(e.idCotizacion==null?null:e.idCotizacion.precio)||0,"USD","symbol","1.2-2")),l(2),C(e.estado==="programado"?37:-1),l(),C(e.estado==="en_camino"?38:-1),l(),C(e.estado==="en_progreso"?39:-1)}}function Ve(o,p){if(o&1&&(t(0,"ion-list",10),T(1,Fe,40,23,"ion-card",12,Se),i()),o&2){let e=m();l(),S(e.trabajosFiltrados)}}var Xe=(()=>{class o{constructor(){this.router=j(R),this.trabajosServicio=j(Te),this.trabajos=[],this.trabajosFiltrados=[],this.filtroEstado="todos",this.cargando=!1,de({locationOutline:he,timeOutline:ve,chevronForward:fe,calendarOutline:pe,personOutline:Me,cashOutline:ue,checkmarkCircleOutline:be,hourglassOutline:je,flashOutline:Ce,callOutline:_e,chatbubbleOutline:ge,navigateOutline:Pe,hammerOutline:xe,briefcaseOutline:me})}ngOnInit(){this.cargarTrabajos()}cargarTrabajos(){this.cargando=!0,this.trabajosServicio.obtenerMisTrabajos().subscribe({next:e=>{this.cargando=!1,e.datos&&(this.trabajos=e.datos.trabajos||e.datos||[],Array.isArray(this.trabajos)||(this.trabajos=[]),this.filtrar())},error:()=>{this.cargando=!1,this.trabajos=[],this.trabajosFiltrados=[]}})}filtrar(){Array.isArray(this.trabajos)||(this.trabajos=[]),this.filtroEstado==="todos"?this.trabajosFiltrados=this.trabajos:this.trabajosFiltrados=this.trabajos.filter(e=>e.estado===this.filtroEstado)}refrescar(e){return M(this,null,function*(){yield this.cargarTrabajos(),e.target.complete()})}verTrabajo(e){this.router.navigate(["/trabajo",e])}llamar(e,n){n.stopPropagation(),e&&(window.location.href=`tel:${e}`)}abrirChat(e,n){n.stopPropagation(),e&&this.router.navigate(["/chat",e])}iniciarCamino(e,n){n.stopPropagation(),this.trabajosServicio.actualizarEstado(e,"en_camino").subscribe({next:()=>this.cargarTrabajos()})}iniciarTrabajo(e,n){n.stopPropagation(),this.trabajosServicio.actualizarEstado(e,"en_progreso").subscribe({next:()=>this.cargarTrabajos()})}completarTrabajo(e,n){n.stopPropagation(),this.trabajosServicio.actualizarEstado(e,"completado").subscribe({next:()=>{this.router.navigate(["/nueva-resena",e],{queryParams:{tipo:"cliente"}})},error:()=>{this.cargarTrabajos()}})}obtenerColorEstado(e){return{pendiente:"warning",en_camino:"tertiary",en_progreso:"primary",completado:"success",cancelado:"danger"}[e]||"medium"}obtenerEtiquetaEstado(e){return{pendiente:"Pendiente",en_camino:"En Camino",en_progreso:"En Progreso",completado:"Completado",cancelado:"Cancelado"}[e]||e}obtenerEtiquetaTipo(e){return Oe.find(a=>a.valor===e)?.etiqueta||e}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=v({type:o,selectors:[["app-mis-trabajos"]],standalone:!0,features:[F],decls:25,vars:2,consts:[["slot","start"],["defaultHref","/tabs/perfil"],["slot","fixed",3,"ionRefresh"],[3,"ngModelChange","ionChange","ngModel"],["value","todos"],["value","en_camino"],["value","en_progreso"],["value","completado"],[1,"loading-container"],[1,"empty-state","ion-padding","ion-text-center"],[1,"lista-trabajos"],["name","briefcase-outline","color","medium"],[1,"tarjeta-trabajo"],[1,"tarjeta-trabajo",3,"click"],[1,"trabajo-header"],["size","small"],[3,"color"],[1,"cliente-info"],["alt","",3,"src"],[1,"cliente-datos"],[1,"nombre"],[1,"ubicacion"],["name","location-outline"],[1,"ubicacion-texto"],[1,"cliente-acciones"],["fill","clear","size","small",3,"click","disabled"],["name","call-outline"],["name","chatbubble-outline"],[1,"trabajo-info"],[1,"info-item"],["name","calendar-outline"],["name","cash-outline"],[1,"acciones-trabajo"],["expand","block",3,"click"],["name","navigate-outline","slot","start"],["name","hammer-outline","slot","start"],["expand","block","color","success",3,"click"],["name","checkmark-circle-outline","slot","start"]],template:function(n,a){n&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),d(3,"ion-back-button",1),i(),t(4,"ion-title"),r(5,"Mis Trabajos"),i()()(),t(6,"ion-content")(7,"ion-refresher",2),_("ionRefresh",function(s){return a.refrescar(s)}),d(8,"ion-refresher-content"),i(),t(9,"ion-segment",3),k("ngModelChange",function(s){return w(a.filtroEstado,s)||(a.filtroEstado=s),s}),_("ionChange",function(){return a.filtrar()}),t(10,"ion-segment-button",4)(11,"ion-label"),r(12,"Todos"),i()(),t(13,"ion-segment-button",5)(14,"ion-label"),r(15,"En Camino"),i()(),t(16,"ion-segment-button",6)(17,"ion-label"),r(18,"En Progreso"),i()(),t(19,"ion-segment-button",7)(20,"ion-label"),r(21,"Completados"),i()()(),h(22,Ee,4,0,"div",8)(23,ye,6,0,"div",9)(24,Ve,3,0,"ion-list",10),i()),n&2&&(l(9),I("ngModel",a.filtroEstado),l(13),C(a.cargando?22:a.trabajosFiltrados.length===0?23:24))},dependencies:[Y,Z,le,re,U,ce,G,J,K,Q,H,te,ee,ae,ne,ie,se,oe,L,X,W,N,q,B,A,$,D],styles:["ion-segment[_ngcontent-%COMP%]{padding:8px 16px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 16px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{padding:64px 32px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:80px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;color:var(--ion-text-color)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.lista-trabajos[_ngcontent-%COMP%]{padding:8px 16px}.tarjeta-trabajo[_ngcontent-%COMP%]{margin:0 0 16px;border-radius:12px;cursor:pointer}.tarjeta-trabajo[_ngcontent-%COMP%]:active{transform:scale(.98)}.trabajo-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}ion-card-title[_ngcontent-%COMP%]{font-size:16px}.cliente-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:var(--ion-color-light);border-radius:8px;margin-bottom:12px}.cliente-info[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:44px;height:44px}.cliente-info[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]{flex:1}.cliente-info[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]   .nombre[_ngcontent-%COMP%]{display:block;font-weight:600;font-size:14px}.cliente-info[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]   .ubicacion[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:12px;color:var(--ion-color-medium);max-width:100%;overflow:hidden}.cliente-info[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]   .ubicacion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px;flex-shrink:0}.cliente-info[_ngcontent-%COMP%]   .cliente-datos[_ngcontent-%COMP%]   .ubicacion[_ngcontent-%COMP%]   .ubicacion-texto[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.cliente-info[_ngcontent-%COMP%]   .cliente-acciones[_ngcontent-%COMP%]{display:flex}.trabajo-info[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:12px}.trabajo-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:13px;color:var(--ion-color-medium)}.trabajo-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.acciones-trabajo[_ngcontent-%COMP%]{margin-top:12px}.acciones-trabajo[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px}"]})}}return o})();export{Xe as MisTrabajosPage};
