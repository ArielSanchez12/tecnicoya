import{a as Ie}from"./chunk-X344YWBZ.js";import{a as ze}from"./chunk-PZ6CWC4A.js";import"./chunk-LB4NNBHO.js";import{a as Ee}from"./chunk-RL3NGRP4.js";import{a as Be}from"./chunk-2WRDL5NI.js";import{a as E}from"./chunk-WXOXMQ3X.js";import{A as ve,Aa as Oe,Da as we,Ea as ye,J as Pe,K as be,_ as Se,a as fe,o as xe,q as he,ua as Te,za as Me}from"./chunk-TI2PQS3J.js";import{a as Ce}from"./chunk-XRERQNEZ.js";import"./chunk-JQ3F7U5Y.js";import{A as S,B as t,C as n,D as _,E as P,Ea as L,F as C,Fa as $,G as d,Ga as G,Ia as H,Ja as Q,K as r,Ka as J,L as y,M as h,Ma as K,N as F,Na as X,O as T,Oa as Y,P as M,Q as O,R as A,Sa as Z,T as B,Ua as ee,V as j,W,Ya as ie,Za as te,_ as q,ab as ne,bb as oe,cb as ae,db as ce,eb as re,ia as D,ib as le,j as f,jb as se,k as z,l as u,m as p,n as V,o as c,oa as N,ob as de,qa as R,qb as _e,r as x,s as w,sb as me,ub as ue,vb as pe,w as g,wa as U,wb as ge,y as k,z as b}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as v}from"./chunk-B4AJQJMI.js";var ke=(i,l)=>l.valor,Ve=(i,l)=>l._id;function Fe(i,l){if(i&1&&(t(0,"ion-select-option",9),r(1),n()),i&2){let e=l.$implicit;w("value",e.valor),c(),h(" ",e.etiqueta," ")}}function Ae(i,l){i&1&&(t(0,"div",10),_(1,"ion-spinner"),t(2,"p"),r(3,"Buscando t\xE9cnicos..."),n()())}function je(i,l){i&1&&(t(0,"div",11),_(1,"ion-icon",13),t(2,"p"),r(3,"No se encontraron t\xE9cnicos"),n()())}function We(i,l){i&1&&(t(0,"span",20),_(1,"ion-icon",33),r(2," Verificado "),n())}function qe(i,l){if(i&1&&(t(0,"ion-chip",25)(1,"ion-label"),r(2),n()()),i&2){let e=l.$implicit,a=d(4);c(2),y(a.obtenerEtiquetaEspecialidad(e))}}function De(i,l){if(i&1&&(t(0,"ion-chip",26)(1,"ion-label"),r(2),n()()),i&2){let e=d().$implicit;c(2),h("+",((e.datosTecnico==null||e.datosTecnico.especialidades==null?null:e.datosTecnico.especialidades.length)||0)-3,"")}}function Ne(i,l){i&1&&(t(0,"ion-badge",31),r(1,"Disponible"),n())}function Re(i,l){i&1&&(t(0,"ion-badge",32),_(1,"ion-icon",34),r(2," 24/7 "),n())}function Ue(i,l){if(i&1){let e=P();t(0,"ion-card",15),C("click",function(){let o=u(e).$implicit,s=d(3);return p(s.verTecnico(o._id))}),t(1,"ion-card-content")(2,"div",16)(3,"ion-avatar"),_(4,"img",17),n(),t(5,"div",18)(6,"div",19)(7,"h3"),r(8),n(),x(9,We,3,0,"span",20),n(),t(10,"div",21),_(11,"ion-icon",22),t(12,"span"),r(13),B(14,"number"),n(),t(15,"span",23),r(16),n()()()(),t(17,"div",24),b(18,qe,3,1,"ion-chip",25,k),x(20,De,3,1,"ion-chip",26),n(),t(21,"div",27)(22,"div",28),_(23,"ion-icon",29),t(24,"span"),r(25),n()(),t(26,"div",28),_(27,"ion-icon",30),t(28,"span"),r(29),n()(),x(30,Ne,2,0,"ion-badge",31)(31,Re,3,0,"ion-badge",32),n()()()}if(i&2){let e=l.$implicit,a=d(3);c(4),w("src",(e.perfil==null?null:e.perfil.fotoUrl)||(e.perfil==null?null:e.perfil.fotoPerfil)||"assets/avatar-default.png",V),c(4),F("",e.nombre," ",e.apellido,""),c(),g(a.esTecnicoVerificado(e)?9:-1),c(4),y(j(14,11,e.datosTecnico==null?null:e.datosTecnico.calificacionPromedio,"1.1-1")),c(3),h("(",e.datosTecnico==null?null:e.datosTecnico.trabajosCompletados," trabajos)"),c(2),S(e.datosTecnico==null||e.datosTecnico.especialidades==null?null:e.datosTecnico.especialidades.slice(0,3)),c(2),g(((e.datosTecnico==null||e.datosTecnico.especialidades==null?null:e.datosTecnico.especialidades.length)||0)>3?20:-1),c(5),h("",e.datosTecnico==null?null:e.datosTecnico.radioTrabajo," km"),c(4),h("",e.datosTecnico==null?null:e.datosTecnico.experiencia," a\xF1os exp."),c(),g(e.datosTecnico!=null&&e.datosTecnico.disponibleAhora?30:-1),c(),g(e.datosTecnico!=null&&e.datosTecnico.emergencia24h?31:-1)}}function Le(i,l){if(i&1&&(t(0,"ion-list",12),b(1,Ue,32,14,"ion-card",14,Ve),n()),i&2){let e=d(2);c(),S(e.tecnicos)}}function $e(i,l){if(i&1){let e=P();t(0,"div",2)(1,"ion-segment",3),O("ngModelChange",function(o){u(e);let s=d();return M(s.filtroActivo,o)||(s.filtroActivo=o),p(o)}),C("ionChange",function(){u(e);let o=d();return p(o.buscar())}),t(2,"ion-segment-button",4)(3,"ion-label"),r(4,"Todos"),n()(),t(5,"ion-segment-button",5)(6,"ion-label"),r(7,"Disponibles"),n()(),t(8,"ion-segment-button",6)(9,"ion-label"),r(10,"24/7"),n()()(),t(11,"ion-item",7)(12,"ion-select",8),O("ngModelChange",function(o){u(e);let s=d();return M(s.especialidadFiltro,o)||(s.especialidadFiltro=o),p(o)}),C("ionChange",function(){u(e);let o=d();return p(o.buscar())}),t(13,"ion-select-option",9),r(14,"Todas"),n(),b(15,Fe,2,2,"ion-select-option",9,ke),n()()(),x(17,Ae,4,0,"div",10)(18,je,4,0,"div",11)(19,Le,3,0,"ion-list",12)}if(i&2){let e=d();c(),T("ngModel",e.filtroActivo),c(11),T("ngModel",e.especialidadFiltro),c(),w("value",null),c(2),S(e.tiposServicio),c(2),g(e.cargando?17:e.tecnicos.length===0?18:19)}}function Ge(i,l){i&1&&(t(0,"div",10),_(1,"ion-spinner"),t(2,"p"),r(3,"Buscando servicios..."),n()())}function He(i,l){i&1&&(t(0,"div",11),_(1,"ion-icon",37),t(2,"p"),r(3,"No hay servicios disponibles"),n()())}function Qe(i,l){i&1&&(t(0,"ion-badge",32),r(1,"URGENTE"),n())}function Je(i,l){if(i&1){let e=P();t(0,"div",43)(1,"ion-button",45),C("click",function(o){u(e);let s=d().$implicit,m=d(3);return p(m.editarCotizacion(s.miCotizacionId,o))}),_(2,"ion-icon",46),r(3," Editar "),n(),t(4,"ion-button",47),C("click",function(o){u(e);let s=d().$implicit,m=d(3);return p(m.eliminarCotizacion(s.miCotizacionId,o))}),_(5,"ion-icon",48),n()()}}function Ke(i,l){if(i&1){let e=P();t(0,"ion-button",49),C("click",function(o){u(e);let s=d().$implicit,m=d(3);return p(m.cotizar(s._id,o))}),r(1," Cotizar "),n()}}function Xe(i,l){if(i&1){let e=P();t(0,"ion-card",39),C("click",function(){let o=u(e).$implicit,s=d(3);return p(s.verServicio(o._id))}),t(1,"ion-card-header")(2,"div",40)(3,"ion-card-title"),r(4),n(),x(5,Qe,2,0,"ion-badge",32),n()(),t(6,"ion-card-content")(7,"p",41),r(8),B(9,"slice"),n(),t(10,"div",42)(11,"span"),_(12,"ion-icon",29),r(13),n(),x(14,Je,6,0,"div",43)(15,Ke,2,0,"ion-button",44),n()()()}if(i&2){let e=l.$implicit;c(4),y(e.titulo),c(),g(e.urgencia==="emergencia"?5:-1),c(3),h("",W(9,5,e.descripcion,0,100),"..."),c(5),h(" ",e.ubicacion.ciudad," "),c(),g(e.yaCotizado?14:15)}}function Ye(i,l){if(i&1&&(t(0,"ion-list"),b(1,Xe,16,9,"ion-card",38,Ve),n()),i&2){let e=d(2);c(),S(e.servicios)}}function Ze(i,l){if(i&1){let e=P();t(0,"div",2)(1,"ion-segment",3),O("ngModelChange",function(o){u(e);let s=d();return M(s.filtroServicios,o)||(s.filtroServicios=o),p(o)}),C("ionChange",function(){u(e);let o=d();return p(o.buscarServicios())}),t(2,"ion-segment-button",4)(3,"ion-label"),r(4,"Todos"),n()(),t(5,"ion-segment-button",35)(6,"ion-label"),r(7,"Urgentes"),n()(),t(8,"ion-segment-button",36)(9,"ion-label"),r(10,"Cercanos"),n()()()(),x(11,Ge,4,0,"div",10)(12,He,4,0,"div",11)(13,Ye,3,0,"ion-list")}if(i&2){let e=d();c(),T("ngModel",e.filtroServicios),c(10),g(e.cargando?11:e.servicios.length===0?12:13)}}var xi=(()=>{class i{constructor(){this.router=f(D),this.authServicio=f(Ce),this.usuariosServicio=f(Ie),this.serviciosServicio=f(Be),this.cotizacionesServicio=f(Ee),this.geoServicio=f(ze),this.alertCtrl=f(de),this.toastCtrl=f(_e),this.terminoBusqueda="",this.filtroActivo="todos",this.filtroServicios="todos",this.especialidadFiltro=null,this.tecnicos=[],this.servicios=[],this.cargando=!1,this.tiposServicio=E,fe({starOutline:Oe,star:Me,locationOutline:Se,checkmarkCircle:xe,timeOutline:we,flashOutline:be,filterOutline:Pe,shieldCheckmarkOutline:Te,createOutline:ve,trashOutline:ye,checkmarkDoneOutline:he})}ngOnInit(){this.esCliente?this.buscar():this.buscarServicios()}get esCliente(){return this.authServicio.esCliente()}get esTecnico(){return this.authServicio.esTecnico()}buscar(){return v(this,null,function*(){this.cargando=!0;let e={};this.especialidadFiltro&&(e.especialidad=this.especialidadFiltro),this.filtroActivo==="disponibles"?e.disponibleAhora=!0:this.filtroActivo==="emergencia"&&(e.emergencia24h=!0),this.usuariosServicio.buscarTecnicos(e).subscribe({next:a=>{this.cargando=!1,a.datos?.tecnicos&&Array.isArray(a.datos.tecnicos)?this.tecnicos=a.datos.tecnicos:a.datos&&Array.isArray(a.datos)?this.tecnicos=a.datos:Array.isArray(a)?this.tecnicos=a:this.tecnicos=[],console.log("T\xE9cnicos encontrados:",this.tecnicos.length)},error:a=>{console.error("Error al buscar t\xE9cnicos:",a),this.cargando=!1,this.tecnicos=[]}})})}buscarServicios(){return v(this,null,function*(){this.cargando=!0;let e=this.obtenerCoordenadasTecnico(),a={latitud:e.latitud,longitud:e.longitud,radio:15};this.filtroServicios==="urgentes"&&(a.urgencia="emergencia"),this.serviciosServicio.obtenerServiciosDisponibles(a).subscribe({next:o=>{this.cargando=!1,o.datos&&(this.servicios=o.datos)},error:()=>{this.cargando=!1}})})}refrescar(e){return v(this,null,function*(){this.esCliente?yield this.buscar():yield this.buscarServicios(),e.target.complete()})}obtenerCoordenadasTecnico(){let e={latitud:-.1807,longitud:-78.4678},s=this.authServicio.obtenerUsuario()?.datosTecnico?.ubicacionBase?.coordenadas;if(s?.coordinates?.length===2){let[m,I]=s.coordinates;if(m!==0||I!==0)return{longitud:m,latitud:I}}return e}verTecnico(e){this.router.navigate(["/tecnico",e])}verServicio(e){this.router.navigate(["/servicio",e])}cotizar(e,a){a.stopPropagation(),this.router.navigate(["/nueva-cotizacion",e])}editarCotizacion(e,a){a.stopPropagation(),this.router.navigate(["/editar-cotizacion",e])}eliminarCotizacion(e,a){return v(this,null,function*(){a.stopPropagation(),yield(yield this.alertCtrl.create({header:"Cancelar Cotizaci\xF3n",message:"\xBFEst\xE1s seguro de que deseas cancelar esta cotizaci\xF3n?",buttons:[{text:"No",role:"cancel"},{text:"S\xED, cancelar",role:"destructive",handler:()=>{this.cotizacionesServicio.cancelarCotizacion(e).subscribe({next:()=>v(this,null,function*(){yield(yield this.toastCtrl.create({message:"Cotizaci\xF3n cancelada",duration:2e3,color:"success"})).present(),this.buscarServicios()}),error:()=>v(this,null,function*(){yield(yield this.toastCtrl.create({message:"Error al cancelar la cotizaci\xF3n",duration:2e3,color:"danger"})).present()})})}}]})).present()})}obtenerEtiquetaEspecialidad(e){return E.find(o=>o.valor===e)?.etiqueta||e}esTecnicoVerificado(e){return e?.datosTecnico?.membresia?.badgeVerificado===!0||e?.datosTecnico?.verificado===!0}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=z({type:i,selectors:[["app-buscar"]],standalone:!0,features:[A],decls:11,vars:3,consts:[["placeholder","Buscar...","debounce","300",3,"ngModelChange","ionInput","ngModel"],["slot","fixed",3,"ionRefresh"],[1,"filtros","ion-padding"],[3,"ngModelChange","ionChange","ngModel"],["value","todos"],["value","disponibles"],["value","emergencia"],[1,"filtro-especialidad"],["placeholder","Todas las especialidades","interface","action-sheet",3,"ngModelChange","ionChange","ngModel"],[3,"value"],[1,"loading-container"],[1,"empty-state","ion-padding"],[1,"lista-tecnicos"],["name","search-outline","color","medium"],[1,"tarjeta-tecnico"],[1,"tarjeta-tecnico",3,"click"],[1,"tecnico-header"],["alt","Foto",3,"src"],[1,"tecnico-info"],[1,"nombre-row"],[1,"badge-tecnico-verificado"],[1,"calificacion"],["name","star","color","warning"],[1,"trabajos"],[1,"especialidades"],["size","small",1,"chip-especialidad"],["size","small","color","medium"],[1,"tecnico-footer"],[1,"info-item"],["name","location-outline"],["name","time-outline"],["color","success"],["color","danger"],["name","shield-checkmark-outline"],["name","flash-outline"],["value","urgentes"],["value","cercanos"],["name","briefcase-outline","color","medium"],[1,"tarjeta-servicio"],[1,"tarjeta-servicio",3,"click"],[1,"servicio-header"],[1,"descripcion"],[1,"servicio-footer"],[1,"botones-cotizado"],["size","small"],["size","small","color","success","fill","outline",3,"click"],["name","create-outline","slot","start"],["size","small","color","danger","fill","outline",3,"click"],["name","trash-outline","slot","icon-only"],["size","small",3,"click"]],template:function(a,o){a&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),r(3,"Buscar"),n()(),t(4,"ion-toolbar")(5,"ion-searchbar",0),O("ngModelChange",function(m){return M(o.terminoBusqueda,m)||(o.terminoBusqueda=m),m}),C("ionInput",function(){return o.buscar()}),n()()(),t(6,"ion-content")(7,"ion-refresher",1),C("ionRefresh",function(m){return o.refrescar(m)}),_(8,"ion-refresher-content"),n(),x(9,$e,20,4)(10,Ze,14,2),n()),a&2&&(c(5),T("ngModel",o.terminoBusqueda),c(4),g(o.esCliente?9:-1),c(),g(o.esTecnico?10:-1))},dependencies:[Y,Z,se,le,ue,pe,ae,ie,H,Q,J,K,X,me,$,L,ee,te,re,G,ne,oe,ge,ce,q,U,N,R],styles:[".filtros[_ngcontent-%COMP%]{background:var(--ion-background-color);position:sticky;top:0;z-index:10}.filtro-especialidad[_ngcontent-%COMP%]{margin-top:12px;--background: var(--ion-color-light);--border-radius: 8px}.filtro-especialidad[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{color:var(--ion-color-dark);--placeholder-color: var(--ion-color-medium)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-top:16px}.lista-tecnicos[_ngcontent-%COMP%]{padding:0 16px}.tarjeta-tecnico[_ngcontent-%COMP%]{margin:0 0 12px;border-radius:12px;cursor:pointer}.tarjeta-tecnico[_ngcontent-%COMP%]:active{transform:scale(.98)}.tecnico-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:12px}.tecnico-header[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:56px;height:56px}.tecnico-header[_ngcontent-%COMP%]   .tecnico-info[_ngcontent-%COMP%]{flex:1}.tecnico-header[_ngcontent-%COMP%]   .tecnico-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;font-weight:600}.tecnico-header[_ngcontent-%COMP%]   .tecnico-info[_ngcontent-%COMP%]   .calificacion[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.tecnico-header[_ngcontent-%COMP%]   .tecnico-info[_ngcontent-%COMP%]   .calificacion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.tecnico-header[_ngcontent-%COMP%]   .tecnico-info[_ngcontent-%COMP%]   .calificacion[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.tecnico-header[_ngcontent-%COMP%]   .tecnico-info[_ngcontent-%COMP%]   .calificacion[_ngcontent-%COMP%]   .trabajos[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-weight:400}.tecnico-header[_ngcontent-%COMP%]   .verificado[_ngcontent-%COMP%]{font-size:24px}.especialidades[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:12px}.tecnico-footer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex-wrap:wrap}.tecnico-footer[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:12px;color:var(--ion-color-medium)}.tecnico-footer[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.tecnico-footer[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:10px}.tarjeta-servicio[_ngcontent-%COMP%]{margin:0 16px 12px;border-radius:12px;cursor:pointer}.servicio-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.servicio-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:16px;flex:1;margin-right:8px}.descripcion[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px;margin:0 0 12px}.servicio-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.servicio-footer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:var(--ion-color-medium);font-size:13px}.servicio-footer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.servicio-footer[_ngcontent-%COMP%]   .botones-cotizado[_ngcontent-%COMP%]{display:flex;gap:4px;align-items:center}"]})}}return i})();export{xi as BuscarPage};
