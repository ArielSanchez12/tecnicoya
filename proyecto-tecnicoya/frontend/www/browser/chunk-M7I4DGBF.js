import{a as _e}from"./chunk-L2HDJ5P4.js";import{a as me}from"./chunk-RER3LUMB.js";import{Aa as pe,a as re,c as ce,j as le,u as se,xa as de,za as ue}from"./chunk-TI2PQS3J.js";import"./chunk-JQ3F7U5Y.js";import{A as b,Aa as J,B as n,C as o,D as g,E as C,F as x,G as d,Ga as q,Ha as H,Ia as L,Ja as U,K as s,Ka as K,L as S,Ma as Q,N as O,Oa as W,R as I,S as E,Sa as X,Ua as Y,_a as Z,eb as ee,ga as N,ia as k,ib as te,j as v,jb as ie,k as y,l as _,m as f,n as F,na as R,o as c,oa as V,pa as B,qb as ne,r as p,ra as z,s as m,sa as D,sb as oe,ta as $,u as P,va as G,w as u,x as w,xa as A,xb as ae,y as T,z as h}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as M}from"./chunk-B4AJQJMI.js";var j=()=>[1,2,3,4,5];function fe(t,l){t&1&&(n(0,"div",2),g(1,"ion-spinner"),o())}function ge(t,l){if(t&1&&(n(0,"p",5),s(1),o()),t&2){let e=d(2);c(),O(" Cliente: ",e.trabajo.idCliente==null||e.trabajo.idCliente.perfil==null?null:e.trabajo.idCliente.perfil.nombre," ",e.trabajo.idCliente==null||e.trabajo.idCliente.perfil==null?null:e.trabajo.idCliente.perfil.apellido," ")}}function Ce(t,l){if(t&1&&(n(0,"p",5),s(1),o()),t&2){let e=d(2);c(),O(" T\xE9cnico: ",e.trabajo.idTecnico==null||e.trabajo.idTecnico.perfil==null?null:e.trabajo.idTecnico.perfil.nombre," ",e.trabajo.idTecnico==null||e.trabajo.idTecnico.perfil==null?null:e.trabajo.idTecnico.perfil.apellido," ")}}function xe(t,l){if(t&1){let e=C();n(0,"ion-icon",16),x("click",function(){let r=_(e).$implicit,a=d(2);return f(a.setCalificacion(r))}),o()}if(t&2){let e=l.$implicit,i=d(2);P("activa",e<=i.calificacion),m("name",e<=i.calificacion?"star":"star-outline")}}function ve(t,l){t&1&&(n(0,"ion-note",9),s(1,"Selecciona una calificaci\xF3n"),o())}function he(t,l){if(t&1){let e=C();n(0,"ion-icon",16),x("click",function(){let r=_(e).$implicit,a=d(3);return f(a.puntualidad=r)}),o()}if(t&2){let e=l.$implicit,i=d(3);P("activa",e<=i.puntualidad),m("name",e<=i.puntualidad?"star":"star-outline")}}function be(t,l){if(t&1){let e=C();n(0,"ion-icon",16),x("click",function(){let r=_(e).$implicit,a=d(3);return f(a.calidadTrabajo=r)}),o()}if(t&2){let e=l.$implicit,i=d(3);P("activa",e<=i.calidadTrabajo),m("name",e<=i.calidadTrabajo?"star":"star-outline")}}function Pe(t,l){if(t&1){let e=C();n(0,"ion-icon",16),x("click",function(){let r=_(e).$implicit,a=d(3);return f(a.precioJusto=r)}),o()}if(t&2){let e=l.$implicit,i=d(3);P("activa",e<=i.precioJusto),m("name",e<=i.precioJusto?"star":"star-outline")}}function Te(t,l){t&1&&(n(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),s(3,"Calificaciones detalladas"),o()(),n(4,"ion-card-content")(5,"div",17)(6,"span"),s(7,"Puntualidad"),o(),n(8,"div",18),h(9,he,1,3,"ion-icon",7,T),o()(),n(11,"div",17)(12,"span"),s(13,"Calidad del trabajo"),o(),n(14,"div",18),h(15,be,1,3,"ion-icon",7,T),o()(),n(17,"div",17)(18,"span"),s(19,"Precio justo"),o(),n(20,"div",18),h(21,Pe,1,3,"ion-icon",7,T),o()()()()),t&2&&(c(9),b(E(0,j)),c(6),b(E(1,j)),c(6),b(E(2,j)))}function Se(t,l){t&1&&(n(0,"ion-note",11),s(1,"El comentario es obligatorio"),o())}function Ee(t,l){t&1&&(n(0,"ion-note",11),s(1,"M\xEDnimo 20 caracteres"),o())}function Re(t,l){if(t&1){let e=C();n(0,"div",20),g(1,"img",22),n(2,"ion-icon",23),x("click",function(){let r=_(e).$index,a=d(3);return f(a.eliminarFoto(r))}),o()()}if(t&2){let e=l.$implicit;c(),m("src",e,F)}}function je(t,l){if(t&1){let e=C();n(0,"div",24),x("click",function(){_(e);let r=d(3);return f(r.agregarFoto())}),g(1,"ion-icon",25),o()}}function Me(t,l){if(t&1&&(n(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),s(3,"Fotos del trabajo terminado (opcional)"),o()(),n(4,"ion-card-content")(5,"div",19),h(6,Re,3,1,"div",20,w),p(8,je,2,0,"div",21),o()()()),t&2){let e=d(2);c(6),b(e.fotosPreview),c(2),u(e.fotosPreview.length<3?8:-1)}}function Oe(t,l){t&1&&(n(0,"div",13),g(1,"ion-icon",26),n(2,"span"),s(3,"\xA1Ganar\xE1s "),n(4,"strong"),s(5,"+5 puntos"),o(),s(6," por dejar esta rese\xF1a!"),o()())}function ye(t,l){t&1&&g(0,"ion-spinner",15)}function Fe(t,l){t&1&&s(0," Publicar Rese\xF1a ")}function we(t,l){if(t&1){let e=C();n(0,"form",4),x("ngSubmit",function(){_(e);let r=d();return f(r.enviar())}),n(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),s(4,"Trabajo completado"),o()(),n(5,"ion-card-content")(6,"p")(7,"strong"),s(8),o()(),p(9,ge,2,2,"p",5)(10,Ce,2,2,"p",5),o()(),n(11,"ion-card")(12,"ion-card-header")(13,"ion-card-title"),s(14),o()(),n(15,"ion-card-content")(16,"div",6),h(17,xe,1,3,"ion-icon",7,T),o(),n(19,"p",8),s(20),o(),p(21,ve,2,0,"ion-note",9),o()(),p(22,Te,23,3,"ion-card"),n(23,"ion-card")(24,"ion-card-header")(25,"ion-card-title"),s(26),o()(),n(27,"ion-card-content")(28,"ion-item"),g(29,"ion-textarea",10),o(),p(30,Se,2,0,"ion-note",11)(31,Ee,2,0,"ion-note",11),o()(),p(32,Me,9,1,"ion-card"),n(33,"div",12),p(34,Oe,7,0,"div",13),n(35,"ion-button",14),p(36,ye,1,0,"ion-spinner",15)(37,Fe,1,0),o()()()}if(t&2){let e,i,r,a=d();m("formGroup",a.formulario),c(8),S(a.trabajo.idServicio==null?null:a.trabajo.idServicio.titulo),c(),u(a.tipoResena==="cliente"?9:10),c(5),S(a.tipoResena==="cliente"?"\xBFC\xF3mo calificar\xEDas al cliente?":"\xBFC\xF3mo calificar\xEDas el servicio?"),c(3),b(E(15,j)),c(3),S(a.obtenerTextoCalificacion()),c(),u((e=a.formulario.get("calificacion"))!=null&&e.touched&&(!((e=a.formulario.get("calificacion"))==null||e.errors==null)&&e.errors.min)?21:-1),c(),u(a.tipoResena!=="cliente"?22:-1),c(4),S(a.tipoResena==="cliente"?"Cu\xE9ntanos sobre el cliente":"Cu\xE9ntanos tu experiencia"),c(3),m("placeholder",a.tipoResena==="cliente"?"Describe c\xF3mo fue tu experiencia con el cliente...":"Describe c\xF3mo fue tu experiencia con el t\xE9cnico..."),c(),u((i=a.formulario.get("comentario"))!=null&&i.touched&&(!((i=a.formulario.get("comentario"))==null||i.errors==null)&&i.errors.required)?30:-1),c(),u(!((r=a.formulario.get("comentario"))==null||r.errors==null)&&r.errors.minlength?31:-1),c(),u(a.tipoResena!=="cliente"?32:-1),c(2),u(a.tipoResena!=="cliente"?34:-1),c(),m("disabled",!a.formulario.valid||a.enviando),c(),u(a.enviando?36:37)}}var Le=(()=>{class t{constructor(){this.route=v(N),this.router=v(k),this.fb=v(G),this.resenasServicio=v(_e),this.trabajosServicio=v(me),this.toastCtrl=v(ne),this.trabajo=null,this.cargando=!1,this.enviando=!1,this.tipoResena="tecnico",this.calificacion=0,this.puntualidad=0,this.calidadTrabajo=0,this.precioJusto=0,this.fotosPreview=[],this.archivosSeleccionados=[],re({starOutline:pe,star:ue,cameraOutline:le,closeCircle:se,addOutline:ce,sparkles:de})}ngOnInit(){this.formulario=this.fb.group({calificacion:[0,[R.required,R.min(1)]],comentario:["",[R.required,R.minLength(20)]]}),this.route.snapshot.queryParamMap.get("tipo")==="cliente"&&(this.tipoResena="cliente");let i=this.route.snapshot.paramMap.get("id");i&&this.cargarTrabajo(i)}cargarTrabajo(e){this.cargando=!0,this.trabajosServicio.obtenerTrabajo(e).subscribe({next:i=>{this.cargando=!1,i.datos&&(this.trabajo=i.datos.trabajo||i.datos)},error:()=>{this.cargando=!1,this.mostrarToast("Error al cargar informaci\xF3n","danger")}})}setCalificacion(e){this.calificacion=e,this.formulario.patchValue({calificacion:e}),this.formulario.get("calificacion")?.markAsTouched()}obtenerTextoCalificacion(){return["","Muy malo","Malo","Regular","Bueno","Excelente"][this.calificacion]||"Toca las estrellas para calificar"}agregarFoto(){let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=i=>this.onFotoSeleccionada(i),e.click()}onFotoSeleccionada(e){let i=e.target.files?.[0];if(!i||this.fotosPreview.length>=3)return;this.archivosSeleccionados.push(i);let r=new FileReader;r.onload=a=>{this.fotosPreview.push(a.target.result)},r.readAsDataURL(i)}eliminarFoto(e){this.fotosPreview.splice(e,1),this.archivosSeleccionados.splice(e,1)}enviar(){if(!this.formulario.valid||!this.trabajo){this.formulario.markAllAsTouched();return}this.enviando=!0;let i={trabajo:this.trabajo._id,calificacion:this.calificacion,comentario:this.formulario.value.comentario,tipoResena:this.tipoResena};this.tipoResena!=="cliente"&&(i.aspectos={puntualidad:this.puntualidad||this.calificacion,calidad:this.calidadTrabajo||this.calificacion,precioJusto:this.precioJusto||this.calificacion}),console.log("\u{1F4CA} Enviando rese\xF1a:",i),this.resenasServicio.crearResena(i).subscribe({next:r=>M(this,null,function*(){this.enviando=!1;let a=this.tipoResena==="cliente"?"\xA1Gracias por calificar al cliente!":"\xA1Gracias por tu rese\xF1a!";yield this.mostrarToast(a,"success"),this.router.navigate(["/tabs/inicio"])}),error:()=>{this.enviando=!1,this.mostrarToast("Error al publicar rese\xF1a","danger")}})}mostrarToast(e,i="primary"){return M(this,null,function*(){yield(yield this.toastCtrl.create({message:e,duration:2e3,color:i,position:"bottom"})).present()})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=y({type:t,selectors:[["app-nueva-resena"]],standalone:!0,features:[I],decls:9,vars:1,consts:[["slot","start"],["defaultHref","/tabs/inicio"],[1,"loading-container"],[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"tecnico-nombre"],[1,"estrellas-container"],[3,"name","activa"],[1,"calificacion-texto"],["color","danger"],["formControlName","comentario","rows","4",3,"placeholder"],["color","danger",1,"error-note"],[1,"ion-padding"],[1,"puntos-info"],["expand","block","type","submit",3,"disabled"],["name","crescent"],[3,"click","name"],[1,"calificacion-detalle"],[1,"estrellas-mini"],[1,"fotos-grid"],[1,"foto-item"],[1,"foto-agregar"],["alt","Foto",3,"src"],["name","close-circle",1,"btn-eliminar",3,"click"],[1,"foto-agregar",3,"click"],["name","add-outline"],["name","sparkles"]],template:function(i,r){i&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),g(3,"ion-back-button",1),o(),n(4,"ion-title"),s(5,"Escribir Rese\xF1a"),o()()(),n(6,"ion-content"),p(7,fe,2,0,"div",2)(8,we,38,16,"form",3),o()),i&2&&(c(7),u(r.cargando?7:r.trabajo?8:-1))},dependencies:[W,X,ie,te,H,J,L,U,K,Q,Y,ae,q,oe,ee,Z,A,z,V,B,D,$],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:64px}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px}.tecnico-nombre[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px}.estrellas-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;padding:16px 0}.estrellas-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px;color:#ddd;cursor:pointer;transition:transform .2s,color .2s}.estrellas-container[_ngcontent-%COMP%]   ion-icon.activa[_ngcontent-%COMP%]{color:#ffc107}.estrellas-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.calificacion-texto[_ngcontent-%COMP%]{text-align:center;color:var(--ion-color-medium);font-size:14px}.calificacion-detalle[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--ion-color-light)}.calificacion-detalle[_ngcontent-%COMP%]:last-child{border-bottom:none}.calificacion-detalle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px}.calificacion-detalle[_ngcontent-%COMP%]   .estrellas-mini[_ngcontent-%COMP%]{display:flex;gap:4px}.calificacion-detalle[_ngcontent-%COMP%]   .estrellas-mini[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#ddd;cursor:pointer}.calificacion-detalle[_ngcontent-%COMP%]   .estrellas-mini[_ngcontent-%COMP%]   ion-icon.activa[_ngcontent-%COMP%]{color:#ffc107}.error-note[_ngcontent-%COMP%]{display:block;padding:4px 16px;font-size:12px}.fotos-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.foto-item[_ngcontent-%COMP%]{position:relative;aspect-ratio:1;border-radius:8px;overflow:hidden}.foto-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.foto-item[_ngcontent-%COMP%]   .btn-eliminar[_ngcontent-%COMP%]{position:absolute;top:4px;right:4px;font-size:24px;color:var(--ion-color-danger);background:#fff;border-radius:50%;cursor:pointer}.foto-agregar[_ngcontent-%COMP%]{aspect-ratio:1;border:2px dashed var(--ion-color-medium);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--ion-color-medium)}.foto-agregar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:32px}.foto-agregar[_ngcontent-%COMP%]:active{background:var(--ion-color-light)}ion-button[type=submit][_ngcontent-%COMP%]{height:48px;font-size:16px}.puntos-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:12px;margin-bottom:12px;background:var(--ion-color-success);border-radius:8px;color:#fff;font-size:14px}.puntos-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:#fff}.puntos-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fff}"]})}}return t})();export{Le as NuevaResenaPage};
