import{a as g,b as m}from"./chunk-LB4NNBHO.js";import{b as l,i as h}from"./chunk-IBAPA63D.js";import{h as n}from"./chunk-B4AJQJMI.js";var s=m("Geolocation",{web:()=>import("./chunk-HRQNKPZJ.js").then(a=>new a.GeolocationWeb)});var E=(()=>{class a{constructor(){this.ubicacionSubject=new l(null),this.ubicacion$=this.ubicacionSubject.asObservable(),this.watchId=null,this.browserWatchId=null}esNavegador(){return g.getPlatform()==="web"}verificarPermisos(){return n(this,null,function*(){try{if(this.esNavegador())return"geolocation"in navigator;let o=yield s.checkPermissions();return o.location==="granted"||o.coarseLocation==="granted"}catch(o){return console.error("Error verificando permisos:",o),this.esNavegador()&&"geolocation"in navigator}})}solicitarPermisos(){return n(this,null,function*(){try{if(this.esNavegador())return"geolocation"in navigator;let o=yield s.requestPermissions();return o.location==="granted"||o.coarseLocation==="granted"}catch(o){return console.error("Error solicitando permisos:",o),this.esNavegador()&&"geolocation"in navigator}})}obtenerUbicacionNavegador(){return new Promise((o,i)=>{if(!navigator.geolocation){i(new Error("Geolocalizaci\xF3n no soportada en este navegador"));return}navigator.geolocation.getCurrentPosition(t=>o(t),t=>i(t),{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})})}obtenerUbicacionActual(){return n(this,null,function*(){try{let o,i,t;if(this.esNavegador()){console.log("\u{1F310} Usando geolocalizaci\xF3n del navegador...");let e=yield this.obtenerUbicacionNavegador();o=e.coords.latitude,i=e.coords.longitude,t=e.coords.accuracy}else{if(!(yield this.verificarPermisos())&&!(yield this.solicitarPermisos()))throw new Error("Permisos de ubicaci\xF3n denegados");let c=yield s.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4});o=c.coords.latitude,i=c.coords.longitude,t=c.coords.accuracy}let r={latitud:o,longitud:i,precision:t};return console.log("\u{1F4CD} Ubicaci\xF3n obtenida:",r),this.ubicacionSubject.next(r),r}catch(o){return console.error("Error obteniendo ubicaci\xF3n:",o),null}})}iniciarSeguimiento(o){return n(this,null,function*(){try{if(!(yield this.verificarPermisos())&&!(yield this.solicitarPermisos()))throw new Error("Permisos de ubicaci\xF3n denegados");this.watchId=yield s.watchPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3},(t,r)=>{if(r){console.error("Error en seguimiento:",r);return}if(t){let e={latitud:t.coords.latitude,longitud:t.coords.longitude,precision:t.coords.accuracy};this.ubicacionSubject.next(e),o?.(e)}})}catch(i){console.error("Error iniciando seguimiento:",i)}})}detenerSeguimiento(){return n(this,null,function*(){this.watchId&&(yield s.clearWatch({id:this.watchId}),this.watchId=null)})}calcularDistancia(o,i,t,r){let c=this.toRad(t-o),d=this.toRad(r-i),u=Math.sin(c/2)*Math.sin(c/2)+Math.cos(this.toRad(o))*Math.cos(this.toRad(t))*Math.sin(d/2)*Math.sin(d/2),b=6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)));return Math.round(b*100)/100}calcularTiempoEstimado(o,i=30){return Math.round(o/i*60)}formatearDistancia(o){return o<1?`${Math.round(o*1e3)} m`:`${o.toFixed(1)} km`}formatearTiempo(o){if(o<60)return`${o} min`;let i=Math.floor(o/60),t=o%60;return`${i}h ${t}min`}toRad(o){return o*(Math.PI/180)}obtenerPosicionActual(){return n(this,null,function*(){try{if(this.esNavegador()){console.log("\u{1F310} Obteniendo posici\xF3n desde navegador...");let t=yield this.obtenerUbicacionNavegador(),r={coords:{latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,altitude:t.coords.altitude,altitudeAccuracy:t.coords.altitudeAccuracy,heading:t.coords.heading,speed:t.coords.speed},timestamp:t.timestamp};return console.log("\u{1F4CD} Posici\xF3n obtenida:",r.coords.latitude,r.coords.longitude),r}return!(yield this.verificarPermisos())&&!(yield this.solicitarPermisos())?null:yield s.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4})}catch(o){return console.error("Error obteniendo posici\xF3n:",o),null}})}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{E as a};
