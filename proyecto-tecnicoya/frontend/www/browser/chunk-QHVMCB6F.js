import{a as Si}from"./chunk-RER3LUMB.js";import{a as Oi}from"./chunk-VZSTYWCH.js";import{a as Mi}from"./chunk-RL3NGRP4.js";import{a as Pi}from"./chunk-2WRDL5NI.js";import{a as z}from"./chunk-WXOXMQ3X.js";import{Aa as xi,B as si,Da as fi,G as li,Ga as hi,Ja as bi,K as di,M as mi,U as pi,W as _i,X as ui,_ as gi,a as ii,c as ei,d as ti,e as ni,g as oi,t as ai,wa as Ci,y as ri,ya as vi,z as ci}from"./chunk-TI2PQS3J.js";import{a as Z}from"./chunk-XRERQNEZ.js";import"./chunk-JQ3F7U5Y.js";import{A as O,B as o,C as a,D as p,E as f,F as C,Fa as A,G as d,Ga as R,Ia as $,Ja as B,K as r,Ka as q,L as P,M as _,Ma as H,Na as L,Oa as N,R as k,Sa as U,T as M,V as y,W as T,Z as V,aa as F,ab as Q,bb as G,ia as D,ib as Y,j as u,jb as J,k as w,l as v,m as x,o as c,ob as K,qb as W,r as b,sb as X,v as I,w as g,z as S}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h}from"./chunk-B4AJQJMI.js";var zi=(t,l)=>l.valor,j=(t,l)=>l._id;function Ei(t,l){t&1&&(o(0,"div",5),p(1,"ion-icon",10),o(2,"h3"),r(3,"\xBFNecesitas un servicio?"),a(),o(4,"p"),r(5,"Solicita tu primer servicio y conecta con t\xE9cnicos profesionales"),a()())}function Ii(t,l){if(t&1){let i=f();o(0,"div",11),C("click",function(){let n=v(i).$implicit,s=d(2);return x(s.seleccionarTipoServicio(n.valor))}),o(1,"span",12),r(2),a(),o(3,"span",13),r(4),a()()}if(t&2){let i=l.$implicit,e=d(2);c(2),P(e.obtenerEmojiServicio(i.valor)),c(2),P(i.etiqueta)}}function yi(t,l){if(t&1&&(b(0,Ei,6,0,"div",5),o(1,"div",4)(2,"div",6),p(3,"ion-icon",7),o(4,"h3"),r(5,"\xBFQu\xE9 tipo de t\xE9cnico necesitas?"),a(),o(6,"p"),r(7,"Conectaremos con el t\xE9cnico m\xE1s cercano disponible"),a()(),o(8,"div",8),S(9,Ii,5,2,"div",9,zi),a()()),t&2){let i=d();g(i.serviciosRecientes.length===0?0:-1),c(9),O(i.tiposServicioCompletos)}}function Ti(t,l){if(t&1){let i=f();o(0,"ion-card",18),C("click",function(){let n=v(i).$implicit,s=d(2);return x(s.verServicio(n._id))}),o(1,"ion-card-header")(2,"div",19)(3,"ion-card-title"),r(4),a(),o(5,"span",20),r(6),a()()(),o(7,"ion-card-content")(8,"p",21),r(9),M(10,"slice"),a(),o(11,"div",22)(12,"span",23),p(13,"ion-icon",24),r(14),M(15,"date"),a(),o(16,"ion-chip",25),r(17),a()()()()}if(t&2){let i=l.$implicit,e=d(2);c(4),P(i.titulo),c(),I(i.estado),c(),_(" ",e.obtenerEtiquetaEstado(i.estado)," "),c(3),_("",T(10,7,i.descripcion,0,100),"..."),c(5),_(" ",y(15,11,i.fechaCreacion,"dd/MM/yyyy")," "),c(3),_(" ",e.obtenerEtiquetaTipo(i.tipo)," ")}}function ji(t,l){if(t&1&&(o(0,"div",4)(1,"div",14)(2,"h3"),r(3,"Mis Servicios"),a(),o(4,"ion-button",15),r(5," Ver todos "),p(6,"ion-icon",16),a()(),S(7,Ti,18,14,"ion-card",17,j),a()),t&2){let i=d();c(7),O(i.serviciosRecientes)}}function wi(t,l){if(t&1){let i=f();o(0,"ion-card",18),C("click",function(){let n=v(i).$implicit,s=d(2);return x(s.verTrabajo(n._id))}),o(1,"ion-card-content")(2,"div",27)(3,"div",28)(4,"h4"),r(5),a(),o(6,"span",20),r(7),a()(),o(8,"p"),r(9),M(10,"date"),a()()()()}if(t&2){let i=l.$implicit,e=d(2);c(5),_("Trabajo #",i._id.slice(-6),""),c(),I(i.estado),c(),_(" ",e.obtenerEtiquetaEstadoTrabajo(i.estado)," "),c(2),P(y(10,5,i.fechaProgramada,"dd/MM/yyyy HH:mm"))}}function ki(t,l){if(t&1&&(o(0,"div",4)(1,"div",14)(2,"h3"),r(3,"Trabajos Activos"),a(),o(4,"ion-button",26),r(5," Ver todos "),p(6,"ion-icon",16),a()(),S(7,wi,11,8,"ion-card",17,j),a()),t&2){let i=d();c(7),O(i.trabajosActivos)}}function Vi(t,l){t&1&&(o(0,"div",30),p(1,"ion-icon",31),o(2,"p"),r(3,"No hay servicios disponibles en tu zona"),a()())}function Fi(t,l){t&1&&(o(0,"ion-badge",32),r(1,"URGENTE"),a())}function Di(t,l){if(t&1){let i=f();o(0,"div",35)(1,"ion-button",36),C("click",function(n){v(i);let s=d().$implicit,m=d(3);return x(m.editarCotizacion(s._id,n))}),r(2," Editar "),a(),o(3,"ion-button",37),C("click",function(n){v(i);let s=d().$implicit,m=d(3);return x(m.eliminarCotizacion(s._id,n))}),p(4,"ion-icon",38),a()()}}function Ai(t,l){if(t&1){let i=f();o(0,"ion-button",39),C("click",function(n){v(i);let s=d().$implicit,m=d(3);return x(m.cotizar(s._id,n))}),r(1," Cotizar "),a()}}function Ri(t,l){if(t&1){let i=f();o(0,"ion-card",18),C("click",function(){let n=v(i).$implicit,s=d(3);return x(s.verServicio(n._id))}),o(1,"ion-card-header")(2,"div",19)(3,"ion-card-title"),r(4),a(),b(5,Fi,2,0,"ion-badge",32),a()(),o(6,"ion-card-content")(7,"p",21),r(8),M(9,"slice"),a(),o(10,"div",22)(11,"span",33),p(12,"ion-icon",34),r(13),a(),b(14,Di,5,0,"div",35)(15,Ai,2,0,"ion-button",25),a()()()}if(t&2){let i=l.$implicit,e=d(3);c(4),P(i.titulo),c(),g(i.urgencia==="emergencia"?5:-1),c(3),_("",T(9,5,i.descripcion,0,80),"..."),c(5),_(" ",(i.ubicacion==null?null:i.ubicacion.direccion)||"Sin ubicaci\xF3n"," "),c(),g(e.misCotizacionesIds.has(i._id)?14:15)}}function $i(t,l){if(t&1&&S(0,Ri,16,9,"ion-card",17,j),t&2){let i=d(2);O(i.serviciosDisponibles)}}function Bi(t,l){if(t&1&&(o(0,"div",4)(1,"div",14)(2,"h3"),r(3,"Servicios Disponibles"),a(),o(4,"ion-button",29),r(5," Ver m\xE1s "),p(6,"ion-icon",16),a()(),b(7,Vi,4,0,"div",30)(8,$i,2,0),a()),t&2){let i=d();c(7),g(i.serviciosDisponibles.length===0?7:8)}}var de=(()=>{class t{constructor(){this.router=u(D),this.authServicio=u(Z),this.serviciosServicio=u(Pi),this.trabajosServicio=u(Si),this.socketServicio=u(Oi),this.cotizacionesServicio=u(Mi),this.alertCtrl=u(K),this.toastCtrl=u(W),this.usuario=null,this.serviciosRecientes=[],this.serviciosDisponibles=[],this.trabajosActivos=[],this.cargando=!1,this.misCotizacionesIds=new Map,this.serviciosPopulares=z.slice(0,8),this.tiposServicioCompletos=z,this.subscriptions=[],this.emojisServicio={plomeria:"\u{1F527}",electricidad:"\u26A1",cerrajeria:"\u{1F511}",carpinteria:"\u{1F528}",pintura:"\u{1F3A8}",aire_acondicionado:"\u2744\uFE0F",refrigeracion:"\u{1F9CA}",albanileria:"\u{1F9F1}",herreria:"\u2699\uFE0F",jardineria:"\u{1F331}",limpieza:"\u{1F9F9}",mudanzas:"\u{1F4E6}",electrodomesticos:"\u{1F4FA}",computadoras:"\u{1F4BB}",otro:"\u{1F528}"},ii({addOutline:ei,flashOutline:di,locationOutline:gi,starOutline:xi,constructOutline:ci,briefcaseOutline:ni,timeOutline:fi,chevronForwardOutline:ai,alertCircleOutline:ti,waterOutline:bi,keyOutline:pi,hammerOutline:mi,colorPaletteOutline:ri,snowOutline:Ci,businessOutline:oi,leafOutline:ui,sparklesOutline:vi,cubeOutline:si,tvOutline:hi,laptopOutline:_i,ellipsisHorizontalOutline:li})}ngOnInit(){this.usuario=this.authServicio.obtenerUsuario(),this.socketServicio.conectar(),this.cargarDatos(),this.configurarSuscripciones()}ngOnDestroy(){this.subscriptions.forEach(i=>i.unsubscribe())}configurarSuscripciones(){let i=this.socketServicio.notificacion$.subscribe(e=>{["nueva_cotizacion","cotizacion_aceptada","cotizacion_cancelada","cotizacion_no_seleccionada","trabajo_estado_actualizado","estado_actualizado"].includes(e.tipo)&&(console.log("\u{1F504} Recargando datos por notificaci\xF3n:",e.tipo),this.cargarDatos())});this.subscriptions.push(i)}get esCliente(){return this.authServicio.esCliente()}get esTecnico(){return this.authServicio.esTecnico()}cargarDatos(){return h(this,null,function*(){this.cargando=!0;try{if(this.esCliente)this.serviciosServicio.obtenerMisServicios({limite:3}).subscribe({next:i=>{i.datos&&(this.serviciosRecientes=Array.isArray(i.datos)?i.datos:[])},error:i=>console.log("Error cargando servicios:",i)});else if(this.esTecnico){let i=this.obtenerCoordenadasTecnico();console.log("\u{1F4CD} Coordenadas para buscar servicios:",i),this.serviciosServicio.obtenerServiciosDisponibles({limite:5,latitud:i?.latitud??-.1807,longitud:i?.longitud??-78.4678,radio:15}).subscribe({next:e=>{e.datos&&(this.serviciosDisponibles=Array.isArray(e.datos)?e.datos:[],this.cargarMisCotizaciones())},error:e=>{console.log("Error cargando servicios disponibles:",e),this.serviciosDisponibles=[]}}),this.trabajosServicio.obtenerMisTrabajos({limite:3}).subscribe({next:e=>{if(e.datos){let n=Array.isArray(e.datos)?e.datos:[];this.trabajosActivos=n.filter(s=>["programado","en_camino","en_progreso"].includes(s.estado))}},error:e=>{console.log("Error cargando trabajos:",e),this.trabajosActivos=[]}})}}finally{this.cargando=!1}})}refrescar(i){return h(this,null,function*(){yield this.cargarDatos(),i.target.complete()})}nuevoServicio(i){i?this.router.navigate(["/nuevo-servicio"],{queryParams:{tipo:i}}):this.router.navigate(["/nuevo-servicio"])}obtenerEmojiServicio(i){return this.emojisServicio[i]||"\u{1F527}"}seleccionarTipoServicio(i){this.router.navigate(["/nuevo-servicio"],{queryParams:{tipo:i}})}tecnicoInstantaneo(){this.router.navigate(["/tecnico-instantaneo"])}verServicio(i){this.router.navigate(["/servicio",i])}verTrabajo(i){this.router.navigate(["/trabajo",i])}cotizar(i,e){e.stopPropagation(),this.router.navigate(["/nueva-cotizacion",i])}editarCotizacion(i,e){e.stopPropagation();let n=this.misCotizacionesIds.get(i);n&&this.router.navigate(["/nueva-cotizacion",i],{queryParams:{editar:n}})}eliminarCotizacion(i,e){return h(this,null,function*(){e.stopPropagation();let n=this.misCotizacionesIds.get(i);if(!n){console.error("No se encontr\xF3 la cotizaci\xF3n para el servicio:",i);return}yield(yield this.alertCtrl.create({header:"Eliminar Cotizaci\xF3n",message:"\xBFEst\xE1s seguro de que deseas eliminar esta cotizaci\xF3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:()=>{this.cotizacionesServicio.cancelarCotizacion(n).subscribe({next:()=>h(this,null,function*(){this.misCotizacionesIds.delete(i),yield(yield this.toastCtrl.create({message:"Cotizaci\xF3n eliminada correctamente",duration:2e3,color:"success"})).present(),this.cargarDatos()}),error:m=>h(this,null,function*(){console.error("Error eliminando cotizaci\xF3n:",m),yield(yield this.toastCtrl.create({message:m.error?.mensaje||"Error al eliminar la cotizaci\xF3n",duration:3e3,color:"danger"})).present()})})}}]})).present()})}cargarMisCotizaciones(){this.cotizacionesServicio.obtenerMisCotizaciones({limite:100}).subscribe({next:i=>{this.misCotizacionesIds.clear(),(i.datos?.cotizaciones||[]).forEach(n=>{if(n.estado==="pendiente"){let s=typeof n.idServicio=="string"?n.idServicio:n.idServicio?._id;s&&this.misCotizacionesIds.set(s,n._id)}}),console.log("\u{1F4CB} Cotizaciones cargadas:",this.misCotizacionesIds.size)},error:i=>{console.log("Error cargando cotizaciones:",i)}})}obtenerEtiquetaTipo(i){return z.find(n=>n.valor===i)?.etiqueta||i}obtenerEtiquetaEstado(i){return{publicado:"Publicado",cotizado:"Cotizado",asignado:"Asignado",en_progreso:"En Progreso",completado:"Completado",cancelado:"Cancelado"}[i]||i}obtenerEtiquetaEstadoTrabajo(i){return{programado:"Programado",en_camino:"En Camino",en_progreso:"En Progreso",completado:"Completado",cancelado:"Cancelado"}[i]||i}obtenerCoordenadasTecnico(){let i={latitud:-.1807,longitud:-78.4678},s=this.authServicio.obtenerUsuario()?.datosTecnico?.ubicacionBase?.coordenadas;if(s?.coordinates?.length===2){let[m,E]=s.coordinates;if(m!==0||E!==0)return{longitud:m,latitud:E}}return console.log("\u26A0\uFE0F T\xE9cnico sin ubicaci\xF3n configurada, usando Quito por defecto"),i}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275cmp=w({type:t,selectors:[["app-inicio"]],standalone:!0,features:[k],decls:17,vars:5,consts:[["color","primary"],["slot","fixed",3,"ionRefresh"],[1,"inicio-container","ion-padding"],[1,"saludo-section"],[1,"section"],[1,"empty-state-grande"],[1,"header-info-inicio"],["name","flash-outline",1,"icono-principal"],[1,"tipos-grid-inicio"],[1,"tipo-card-inicio"],["name","construct-outline","color","primary"],[1,"tipo-card-inicio",3,"click"],[1,"emoji"],[1,"nombre"],[1,"section-header"],["fill","clear","size","small","routerLink","/mis-servicios"],["slot","end","name","chevron-forward-outline"],[1,"tarjeta-servicio"],[1,"tarjeta-servicio",3,"click"],[1,"card-header-content"],[1,"badge-estado"],[1,"descripcion-corta"],[1,"card-footer"],[1,"fecha"],["name","time-outline"],["size","small"],["fill","clear","size","small","routerLink","/tabs/mis-trabajos"],[1,"trabajo-item"],[1,"trabajo-info"],["fill","clear","size","small","routerLink","/buscar"],[1,"empty-state"],["name","briefcase-outline","color","medium"],["color","danger"],[1,"ubicacion"],["name","location-outline"],[1,"botones-cotizado"],["size","small","color","success","fill","outline",3,"click"],["size","small","color","danger","fill","outline",3,"click"],["name","trash-outline","slot","icon-only"],["size","small",3,"click"]],template:function(e,n){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),r(3,"T\xE9cnicoYa"),a()()(),o(4,"ion-content")(5,"ion-refresher",1),C("ionRefresh",function(m){return n.refrescar(m)}),p(6,"ion-refresher-content"),a(),o(7,"div",2)(8,"div",3)(9,"h2"),r(10),a(),o(11,"p"),r(12,"\xBFQu\xE9 necesitas hoy?"),a()(),b(13,yi,11,1,"div",4)(14,ji,9,0,"div",4)(15,ki,9,0,"div",4)(16,Bi,9,1,"div",4),a()()),e&2&&(c(10),_("Hola, ",(n.usuario==null?null:n.usuario.nombre)||"Usuario"," \u{1F44B}"),c(3),g(n.esCliente?13:-1),c(),g(n.esCliente&&n.serviciosRecientes.length>0?14:-1),c(),g(n.esTecnico&&n.trabajosActivos.length>0?15:-1),c(),g(n.esTecnico?16:-1))},dependencies:[N,U,J,Y,R,X,$,B,q,H,Q,G,L,A,V,F],styles:[".inicio-container[_ngcontent-%COMP%]{padding-bottom:80px}.saludo-section[_ngcontent-%COMP%]{margin-bottom:24px}.saludo-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin:0 0 4px}.saludo-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0}.header-info-inicio[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.header-info-inicio[_ngcontent-%COMP%]   .icono-principal[_ngcontent-%COMP%]{font-size:48px;color:var(--ion-color-warning)}.header-info-inicio[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:16px 0 8px}.header-info-inicio[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0;font-size:14px}.tipos-grid-inicio[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}.tipo-card-inicio[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:16px 8px;background:var(--ion-color-light);border-radius:12px;cursor:pointer;transition:all .2s}.tipo-card-inicio[_ngcontent-%COMP%]:active{transform:scale(.95);background:var(--ion-color-primary-tint)}.tipo-card-inicio[_ngcontent-%COMP%]   .emoji[_ngcontent-%COMP%]{font-size:32px;margin-bottom:8px}.tipo-card-inicio[_ngcontent-%COMP%]   .nombre[_ngcontent-%COMP%]{font-size:12px;text-align:center;color:var(--ion-color-dark);font-weight:500}.section[_ngcontent-%COMP%]{margin-bottom:24px}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0 0 16px}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.tarjeta-servicio[_ngcontent-%COMP%]{margin:0 0 12px;border-radius:12px;cursor:pointer}.tarjeta-servicio[_ngcontent-%COMP%]:active{transform:scale(.98)}.card-header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.card-header-content[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:16px;flex:1;margin-right:8px}.descripcion-corta[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px;margin:0 0 12px}.card-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%], .card-footer[_ngcontent-%COMP%]   .ubicacion[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:var(--ion-color-medium);font-size:12px}.card-footer[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .card-footer[_ngcontent-%COMP%]   .ubicacion[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:14px}.trabajo-item[_ngcontent-%COMP%]   .trabajo-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.trabajo-item[_ngcontent-%COMP%]   .trabajo-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:16px}.trabajo-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0 0;color:var(--ion-color-medium);font-size:14px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:32px;background:var(--ion-color-light);border-radius:12px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:12px 0 0}.empty-state-grande[_ngcontent-%COMP%]{text-align:center;padding:32px 24px;background:var(--ion-color-light);border-radius:16px;margin-bottom:24px}.empty-state-grande[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:56px}.empty-state-grande[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin:12px 0 8px;color:var(--ion-color-dark)}.empty-state-grande[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0;font-size:14px}.botones-cotizado[_ngcontent-%COMP%]{display:flex;gap:8px}.botones-cotizado[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1}"]})}}return t})();export{de as InicioPage};
