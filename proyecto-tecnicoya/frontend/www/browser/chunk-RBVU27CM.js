import{a as si}from"./chunk-PZ6CWC4A.js";import"./chunk-LB4NNBHO.js";import{a as li}from"./chunk-2WRDL5NI.js";import{a as ci}from"./chunk-WXOXMQ3X.js";import{_ as ri,a as ei,c as ti,p as oi,pa as ai,u as ni}from"./chunk-TI2PQS3J.js";import"./chunk-JQ3F7U5Y.js";import{Aa as z,B as o,C as e,D as s,E,F as C,G as h,Ga as D,Ha as U,Ia as q,Ja as G,K as n,Oa as j,R as I,Sa as V,Ua as B,Ya as L,_a as R,db as A,eb as H,ga as P,ia as T,ib as J,j as u,jb as K,k as S,l as b,m as x,na as g,o as l,oa as y,ob as Q,pa as O,pb as W,qb as X,r as p,ra as M,s as f,sa as N,sb as Y,ta as F,tb as Z,va as w,w as m,wb as $,xa as k,xb as ii}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as v}from"./chunk-B4AJQJMI.js";function di(t,d){t&1&&(o(0,"div",2),s(1,"ion-spinner"),o(2,"p"),n(3,"Cargando..."),e()())}function ui(t,d){t&1&&(o(0,"ion-note",8),n(1,"El t\xEDtulo es obligatorio"),e())}function mi(t,d){t&1&&(o(0,"ion-note",8),n(1,"M\xEDnimo 10 caracteres"),e())}function pi(t,d){t&1&&(o(0,"ion-note",8),n(1,"La descripci\xF3n es obligatoria"),e())}function fi(t,d){t&1&&(o(0,"ion-note",8),n(1,"M\xEDnimo 20 caracteres"),e())}function gi(t,d){t&1&&s(0,"ion-spinner",14)}function vi(t,d){t&1&&(s(0,"ion-icon",22),n(1," Actualizar ubicaci\xF3n "))}function hi(t,d){t&1&&(o(0,"ion-note",15),s(1,"ion-icon",23),n(2," Ubicaci\xF3n confirmada "),e())}function _i(t,d){t&1&&s(0,"ion-spinner",14)}function bi(t,d){t&1&&(s(0,"ion-icon",24),n(1," Guardar Cambios "))}function xi(t,d){if(t&1){let i=E();o(0,"form",4),C("ngSubmit",function(){b(i);let a=h();return x(a.guardar())}),o(1,"ion-card")(2,"ion-card-content")(3,"ion-item")(4,"ion-label",5),n(5,"Tipo de servicio"),e(),s(6,"ion-input",6),e(),o(7,"ion-item")(8,"ion-label",5),n(9,"T\xEDtulo del problema *"),e(),s(10,"ion-input",7),e(),p(11,ui,2,0,"ion-note",8)(12,mi,2,0,"ion-note",8),o(13,"ion-item")(14,"ion-label",5),n(15,"Descripci\xF3n detallada *"),e(),s(16,"ion-textarea",9),e(),p(17,pi,2,0,"ion-note",8)(18,fi,2,0,"ion-note",8),e()(),o(19,"ion-card")(20,"ion-card-content")(21,"h3",10),n(22,"Ubicaci\xF3n del servicio"),e(),o(23,"ion-item")(24,"ion-label",5),n(25,"Direcci\xF3n *"),e(),s(26,"ion-input",11),e(),o(27,"ion-item")(28,"ion-label",5),n(29,"Referencia"),e(),s(30,"ion-input",12),e(),o(31,"ion-button",13),C("click",function(){b(i);let a=h();return x(a.obtenerUbicacion())}),p(32,gi,1,0,"ion-spinner",14)(33,vi,2,0),e(),p(34,hi,3,0,"ion-note",15),e()(),o(35,"ion-card")(36,"ion-card-content")(37,"h3",10),n(38,"Urgencia"),e(),o(39,"ion-item")(40,"ion-label",5),n(41,"Nivel de urgencia"),e(),o(42,"ion-select",16)(43,"ion-select-option",17),n(44,"Normal"),e(),o(45,"ion-select-option",18),n(46,"Emergencia (tarifa adicional)"),e()()()()(),o(47,"ion-card",19)(48,"ion-card-content")(49,"p")(50,"strong"),n(51,"Nota:"),e(),n(52," Si ya hay t\xE9cnicos que enviaron cotizaciones, ser\xE1n notificados de los cambios realizados."),e()()(),o(53,"div",20)(54,"ion-button",21),p(55,_i,1,0,"ion-spinner",14)(56,bi,2,0),e()()()}if(t&2){let i,r,a,_,c=h();f("formGroup",c.formulario),l(6),f("value",c.obtenerEtiquetaTipo(c.servicio.tipo||c.servicio.tipoServicio)),l(5),m((i=c.formulario.get("titulo"))!=null&&i.touched&&(!((i=c.formulario.get("titulo"))==null||i.errors==null)&&i.errors.required)?11:-1),l(),m(!((r=c.formulario.get("titulo"))==null||r.errors==null)&&r.errors.minlength?12:-1),l(5),m((a=c.formulario.get("descripcion"))!=null&&a.touched&&(!((a=c.formulario.get("descripcion"))==null||a.errors==null)&&a.errors.required)?17:-1),l(),m(!((_=c.formulario.get("descripcion"))==null||_.errors==null)&&_.errors.minlength?18:-1),l(13),f("disabled",c.obteniendoUbicacion),l(),m(c.obteniendoUbicacion?32:33),l(2),m(c.coordenadas?34:-1),l(20),f("disabled",!c.formulario.valid||c.guardando),l(),m(c.guardando?55:56)}}var ki=(()=>{class t{constructor(){this.fb=u(w),this.router=u(T),this.route=u(P),this.toastCtrl=u(X),this.alertCtrl=u(Q),this.loadingCtrl=u(W),this.serviciosServicio=u(li),this.geoServicio=u(si),this.servicioId="",this.servicio=null,this.cargando=!0,this.guardando=!1,this.obteniendoUbicacion=!1,this.coordenadas=null,this.tiposServicio=ci,this.formulario=this.fb.group({titulo:["",[g.required,g.minLength(10)]],descripcion:["",[g.required,g.minLength(20)]],direccion:["",g.required],referencia:[""],urgencia:["normal"]}),ei({locationOutline:ri,saveOutline:ai,closeCircle:ni,addOutline:ti,checkmarkCircleOutline:oi})}ngOnInit(){this.servicioId=this.route.snapshot.params.id,this.cargarServicio()}cargarServicio(){this.cargando=!0,this.serviciosServicio.obtenerServicio(this.servicioId).subscribe({next:i=>{this.cargando=!1,i.exito&&i.datos&&(this.servicio=i.datos.servicio||i.datos,this.llenarFormulario())},error:()=>{this.cargando=!1,this.mostrarToast("Error al cargar el servicio","danger"),this.router.navigate(["/tabs/servicios"])}})}llenarFormulario(){if(!this.servicio)return;this.formulario.patchValue({titulo:this.servicio.titulo,descripcion:this.servicio.descripcion,direccion:this.servicio.ubicacion?.direccion||"",referencia:this.servicio.ubicacion?.referencia||"",urgencia:this.servicio.urgencia||"normal"});let i=this.servicio.ubicacion?.coordenadas?.coordinates;i&&i.length===2&&(this.coordenadas={lng:i[0],lat:i[1]})}obtenerEtiquetaTipo(i){return i?this.tiposServicio.find(a=>a.valor===i)?.etiqueta||i:"No especificado"}obtenerUbicacion(){return v(this,null,function*(){this.obteniendoUbicacion=!0;try{let i=yield this.geoServicio.obtenerPosicionActual();i?(this.coordenadas={lat:i.coords.latitude,lng:i.coords.longitude},this.mostrarToast("Ubicaci\xF3n actualizada")):this.mostrarToast("No se pudo obtener la ubicaci\xF3n","warning")}catch(i){console.error("Error obteniendo ubicaci\xF3n:",i),this.mostrarToast("No se pudo obtener la ubicaci\xF3n","warning")}finally{this.obteniendoUbicacion=!1}})}guardar(){return v(this,null,function*(){if(!this.formulario.valid||!this.servicio)return;yield(yield this.alertCtrl.create({header:"Confirmar cambios",message:"\xBFDeseas guardar los cambios en este servicio?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:()=>this.ejecutarGuardado()}]})).present()})}ejecutarGuardado(){return v(this,null,function*(){this.guardando=!0;let i={titulo:this.formulario.value.titulo,descripcion:this.formulario.value.descripcion,urgencia:this.formulario.value.urgencia,ubicacion:{direccion:this.formulario.value.direccion,referencia:this.formulario.value.referencia}};this.coordenadas&&(i.ubicacion.latitud=this.coordenadas.lat,i.ubicacion.longitud=this.coordenadas.lng),this.serviciosServicio.editarServicio(this.servicioId,i).subscribe({next:r=>{this.guardando=!1,r.exito?(this.mostrarToast("Servicio actualizado correctamente","success"),this.router.navigate(["/detalle-servicio",this.servicioId])):this.mostrarToast(r.mensaje||"Error al actualizar","danger")},error:r=>{this.guardando=!1,this.mostrarToast(r.error?.mensaje||"Error al actualizar servicio","danger")}})})}mostrarToast(i,r="primary"){return v(this,null,function*(){yield(yield this.toastCtrl.create({message:i,duration:3e3,color:r,position:"bottom"})).present()})}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=S({type:t,selectors:[["app-editar-servicio"]],standalone:!0,features:[I],decls:9,vars:2,consts:[["slot","start"],[3,"defaultHref"],[1,"loading-container"],[3,"formGroup"],[3,"ngSubmit","formGroup"],["position","stacked"],["readonly","true",3,"value"],["formControlName","titulo","placeholder","Ej: Fuga de agua en el ba\xF1o"],["color","danger",1,"error-note"],["formControlName","descripcion","placeholder","Describe el problema con el mayor detalle posible...","rows","4"],[1,"seccion-titulo"],["formControlName","direccion","placeholder","Ej: Sector, calle"],["formControlName","referencia","placeholder","Ej: Cerca del parque"],["fill","outline","expand","block",3,"click","disabled"],["name","crescent"],["color","success",1,"ubicacion-confirmada"],["formControlName","urgencia","interface","action-sheet"],["value","normal"],["value","emergencia"],["color","warning",1,"card-info"],[1,"ion-padding"],["expand","block","type","submit",3,"disabled"],["name","location-outline","slot","start"],["name","checkmark-circle-outline"],["name","save-outline","slot","start"]],template:function(r,a){r&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),s(3,"ion-back-button",1),e(),o(4,"ion-title"),n(5,"Editar Servicio"),e()()(),o(6,"ion-content"),p(7,di,4,0,"div",2)(8,xi,57,11,"form",3),e()),r&2&&(l(3),f("defaultHref","/detalle-servicio/"+a.servicioId),l(4),m(a.cargando?7:a.servicio?8:-1))},dependencies:[k,M,y,O,N,F,j,V,K,J,U,z,q,G,B,L,Z,ii,$,A,D,Y,H,R],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:50vh}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--ion-color-medium)}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px}.seccion-titulo[_ngcontent-%COMP%]{margin:0 0 12px;font-size:16px;font-weight:600;color:var(--ion-color-dark)}.error-note[_ngcontent-%COMP%]{display:block;padding:8px 16px;font-size:12px}.ubicacion-confirmada[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:12px;padding:8px 12px;background:var(--ion-color-success-tint);border-radius:8px;font-size:14px}.ubicacion-confirmada[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.card-info[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:12px 16px}.card-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:13px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}"]})}}return t})();export{ki as EditarServicioPage};
