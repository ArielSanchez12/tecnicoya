import{a as De}from"./chunk-Y5JPPF4C.js";import{a as Ae}from"./chunk-X344YWBZ.js";import{a as Fe,c as w}from"./chunk-WXOXMQ3X.js";import{A as Ce,Aa as ke,C as he,D as ve,Da as Ve,Ha as je,K as Pe,N as be,O as Te,_ as Se,a as me,ca as Me,da as Oe,e as _e,i as pe,j as ge,ka as we,m as fe,ma as Ee,s as xe,ta as ye,ua as ze,za as Ie}from"./chunk-TI2PQS3J.js";import{a as ue}from"./chunk-XRERQNEZ.js";import"./chunk-JQ3F7U5Y.js";import{A as j,B as i,C as t,D as c,E as h,Ea as U,F as m,Fa as H,G as s,Ga as Y,Ia as $,Ja as G,K as a,Ka as J,L as f,M as v,Ma as K,N as F,Na as Q,O as S,Oa as X,P as M,Q as O,R as A,Sa as Z,T as P,U as D,Ua as ee,V as T,Y as N,Ya as ie,Za as te,_ as R,ab as ne,bb as oe,ia as B,ib as ae,j as C,jb as re,k as E,l as d,m as u,n as y,o as l,oa as L,ob as le,qa as W,qb as ce,r as x,s as z,sb as se,t as I,w as g,wa as q,y as k,yb as de,z as V}from"./chunk-IBAPA63D.js";import"./chunk-XMAMLXFW.js";import"./chunk-EW67HA6M.js";import"./chunk-WXVXXLBH.js";import"./chunk-EFAAWUSX.js";import"./chunk-GLOUZK3F.js";import"./chunk-N4PXAYQ7.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-NMPY7VJP.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{h as b}from"./chunk-B4AJQJMI.js";function Re(r,p){r&1&&(i(0,"ion-chip",9),c(1,"ion-icon",25),i(2,"ion-label"),a(3,"Verificado"),t()())}function Be(r,p){if(r&1){let e=h();i(0,"ion-card",26),m("click",function(){d(e);let n=s(2);return u(n.verFidelizacion())}),i(1,"ion-card-content")(2,"div",27)(3,"div",28),c(4,"ion-icon",29),i(5,"div")(6,"h4"),a(7),t(),i(8,"p"),a(9),t()()(),c(10,"ion-icon",30),t()()()}if(r&2){let e=s(2);l(4),I("color",e.obtenerColorNivel()),l(3),f(e.obtenerNombreNivel()),l(2),v("",e.fidelizacion.puntos," puntos")}}function Le(r,p){if(r&1&&(i(0,"ion-chip")(1,"ion-label"),a(2),t()()),r&2){let e=p.$implicit,o=s(3);l(2),f(o.obtenerEtiquetaEspecialidad(e))}}function We(r,p){if(r&1){let e=h();i(0,"ion-card",31)(1,"ion-card-header")(2,"ion-card-title"),a(3,"Mis Estad\xEDsticas"),t()(),i(4,"ion-card-content")(5,"div",32)(6,"div",33)(7,"div",34),c(8,"ion-icon",35),a(9),P(10,"number"),t(),i(11,"div",36),a(12,"Calificaci\xF3n"),t()(),i(13,"div",37)(14,"div",38),c(15,"ion-icon",39),a(16),P(17,"number"),t(),i(18,"div",36),a(19,"Fondos"),t()(),i(20,"div",33)(21,"div",34),a(22),t(),i(23,"div",36),a(24,"Trabajos"),t()()()()(),i(25,"ion-card",40)(26,"ion-card-header")(27,"ion-card-title"),a(28,"Disponibilidad"),t()(),i(29,"ion-card-content")(30,"ion-item",11),c(31,"ion-icon",41),i(32,"ion-label"),a(33,"Disponible ahora"),t(),i(34,"ion-toggle",42),O("ngModelChange",function(n){d(e);let _=s(2);return M(_.disponibleAhora,n)||(_.disponibleAhora=n),u(n)}),m("ngModelChange",function(n){d(e);let _=s(2);return u(_.toggleDisponibilidad(n))}),t()(),i(35,"ion-item",11),c(36,"ion-icon",43),i(37,"ion-label"),a(38,"Servicio 24/7 emergencias"),t(),i(39,"ion-toggle",42),O("ngModelChange",function(n){d(e);let _=s(2);return M(_.emergencia24h,n)||(_.emergencia24h=n),u(n)}),m("ngModelChange",function(n){d(e);let _=s(2);return u(_.toggleEmergencia(n))}),t()()()(),i(40,"ion-card")(41,"ion-card-header")(42,"ion-card-title"),a(43,"Especialidades"),t()(),i(44,"ion-card-content")(45,"div",44),V(46,Le,3,1,"ion-chip",null,k),t()()()}if(r&2){let e=s(2);l(9),v(" ",T(10,5,(e.usuario.datosTecnico==null?null:e.usuario.datosTecnico.calificacionPromedio)||(e.usuario.datosTecnico==null?null:e.usuario.datosTecnico.calificacion),"1.1-1")," "),l(7),v(" $",T(17,8,(e.usuario.datosTecnico==null||e.usuario.datosTecnico.fondos==null?null:e.usuario.datosTecnico.fondos.disponible)||0,"1.2-2")," "),l(6),f((e.usuario.datosTecnico==null?null:e.usuario.datosTecnico.trabajosCompletados)||0),l(12),S("ngModel",e.disponibleAhora),l(5),S("ngModel",e.emergencia24h),l(7),j(e.usuario.datosTecnico==null?null:e.usuario.datosTecnico.especialidades)}}function qe(r,p){if(r&1&&(i(0,"ion-item"),c(1,"ion-icon",45),i(2,"ion-label",46),a(3),t()()),r&2){let e=s(2);l(3),f(e.obtenerDireccionTexto(e.usuario.perfil==null?null:e.usuario.perfil.direccion))}}function Ue(r,p){if(r&1&&(i(0,"ion-badge",48),a(1),P(2,"titlecase"),t()),r&2){let e=s(3);l(),v(" ",D(2,1,e.usuario==null||e.usuario.datosTecnico==null||e.usuario.datosTecnico.membresia==null?null:e.usuario.datosTecnico.membresia.tipo)," ")}}function He(r,p){if(r&1&&(i(0,"ion-badge",50),a(1),P(2,"number"),t()),r&2){let e=s(3);l(),v(" $",T(2,1,e.usuario==null||e.usuario.datosTecnico==null||e.usuario.datosTecnico.fondos==null?null:e.usuario.datosTecnico.fondos.disponible,"1.2-2")," ")}}function Ye(r,p){if(r&1){let e=h();i(0,"ion-item",15),m("click",function(){d(e);let n=s(2);return u(n.verMembresias())}),c(1,"ion-icon",47),i(2,"ion-label"),a(3," Membres\xEDas "),x(4,Ue,3,3,"ion-badge",48),t()(),i(5,"ion-item",15),m("click",function(){d(e);let n=s(2);return u(n.retirarFondos())}),c(6,"ion-icon",49),i(7,"ion-label"),a(8," Retirar Fondos "),x(9,He,3,4,"ion-badge",50),t()()}if(r&2){let e=s(2);l(4),g(!(e.usuario==null||e.usuario.datosTecnico==null||e.usuario.datosTecnico.membresia==null)&&e.usuario.datosTecnico.membresia.tipo&&(e.usuario==null||e.usuario.datosTecnico==null||e.usuario.datosTecnico.membresia==null?null:e.usuario.datosTecnico.membresia.tipo)!=="basico"?4:-1),l(5),g(!(e.usuario==null||e.usuario.datosTecnico==null||e.usuario.datosTecnico.fondos==null)&&e.usuario.datosTecnico.fondos.disponible&&(e.usuario==null||e.usuario.datosTecnico==null||e.usuario.datosTecnico.fondos==null?null:e.usuario.datosTecnico.fondos.disponible)>0?9:-1)}}function $e(r,p){if(r&1){let e=h();i(0,"ion-item",15),m("click",function(){d(e);let n=s(2);return u(n.verFidelizacion())}),c(1,"ion-icon",51),i(2,"ion-label"),a(3,"Programa de Fidelizaci\xF3n"),t()()}}function Ge(r,p){if(r&1){let e=h();i(0,"div",3)(1,"div",4),m("click",function(){d(e);let n=s();return u(n.cambiarFoto())}),i(2,"ion-avatar"),c(3,"img",5),t(),i(4,"div",6),c(5,"ion-icon",7),t()(),i(6,"h2"),a(7),t(),i(8,"p",8),a(9),t(),x(10,Re,4,0,"ion-chip",9),t(),x(11,Be,11,4,"ion-card",10)(12,We,48,11),i(13,"ion-card")(14,"ion-card-header")(15,"ion-card-title"),a(16,"Informaci\xF3n de contacto"),t()(),i(17,"ion-card-content")(18,"ion-list",11)(19,"ion-item"),c(20,"ion-icon",12),i(21,"ion-label"),a(22),t()(),i(23,"ion-item"),c(24,"ion-icon",13),i(25,"ion-label"),a(26),t()(),x(27,qe,4,1,"ion-item"),t()()(),i(28,"ion-list",14)(29,"ion-item",15),m("click",function(){d(e);let n=s();return u(n.verMisServicios())}),c(30,"ion-icon",16),i(31,"ion-label"),a(32),t()(),i(33,"ion-item",15),m("click",function(){d(e);let n=s();return u(n.verResenas())}),c(34,"ion-icon",17),i(35,"ion-label"),a(36,"Mis Rese\xF1as"),t()(),x(37,Ye,10,2)(38,$e,4,0,"ion-item",18),i(39,"ion-item",15),m("click",function(){d(e);let n=s();return u(n.verAyuda())}),c(40,"ion-icon",19),i(41,"ion-label"),a(42,"Ayuda y Soporte"),t()(),i(43,"ion-item",15),m("click",function(){d(e);let n=s();return u(n.verTerminos())}),c(44,"ion-icon",20),i(45,"ion-label"),a(46,"T\xE9rminos y Condiciones"),t()(),i(47,"ion-item",15),m("click",function(){d(e);let n=s();return u(n.abrirConfiguracion())}),c(48,"ion-icon",21),i(49,"ion-label"),a(50,"Configuraci\xF3n"),t()(),i(51,"ion-item",22),m("click",function(){d(e);let n=s();return u(n.cerrarSesion())}),c(52,"ion-icon",23),i(53,"ion-label",24),a(54,"Cerrar Sesi\xF3n"),t()()()}if(r&2){let e=s();l(3),z("src",(e.usuario.perfil==null?null:e.usuario.perfil.fotoUrl)||(e.usuario.perfil==null?null:e.usuario.perfil.fotoPerfil)||"assets/avatar-default.png",y),l(4),F("",e.usuario.nombre," ",e.usuario.apellido,""),l(2),f(e.usuario.rol==="tecnico"?"T\xE9cnico":"Cliente"),l(),g(e.esTecnico&&(e.usuario.datosTecnico!=null&&e.usuario.datosTecnico.verificado)?10:-1),l(),g(e.fidelizacion&&!e.esTecnico?11:-1),l(),g(e.esTecnico?12:-1),l(10),f(e.usuario.email),l(4),f((e.usuario.perfil==null?null:e.usuario.perfil.telefono)||e.usuario.telefono||"No registrado"),l(),g(e.usuario.perfil!=null&&e.usuario.perfil.direccion?27:-1),l(5),f(e.esTecnico?"Mis Trabajos":"Mis Servicios"),l(5),g(e.esTecnico?37:-1),l(),g(e.esTecnico?-1:38)}}var ui=(()=>{class r{constructor(){this.router=C(B),this.authServicio=C(ue),this.usuariosServicio=C(Ae),this.fidelizacionServicio=C(De),this.alertCtrl=C(le),this.toastCtrl=C(ce),this.usuario=null,this.fidelizacion=null,this.disponibleAhora=!1,this.emergencia24h=!1,this.actualizando=!1,me({personOutline:we,mailOutline:Oe,callOutline:pe,locationOutline:Se,settingsOutline:ye,logOutOutline:Me,starOutline:ke,star:Ie,briefcaseOutline:_e,shieldCheckmarkOutline:ze,timeOutline:Ve,ribbonOutline:Ee,createOutline:Ce,cameraOutline:ge,chevronForward:xe,flashOutline:Pe,heartOutline:be,helpCircleOutline:Te,documentTextOutline:ve,diamondOutline:he,cashOutline:fe,walletOutline:je})}ngOnInit(){this.cargarDatos()}get esTecnico(){return this.authServicio.esTecnico()}cargarDatos(){this.authServicio.usuarioActual$.subscribe(e=>{this.usuario=e,e?.datosTecnico&&(this.disponibleAhora=e.datosTecnico.disponibleAhora||!1,this.emergencia24h=e.datosTecnico.emergencia24h||!1)}),this.fidelizacionServicio.obtenerMiFidelizacion().subscribe({next:e=>{e.datos&&(this.fidelizacion=e.datos)}})}refrescar(e){return b(this,null,function*(){this.authServicio.cargarUsuario(),this.cargarDatos(),setTimeout(()=>e.target.complete(),1e3)})}cambiarFoto(){this.router.navigate(["/editar-perfil"],{queryParams:{modo:"foto"}})}editarPerfil(){this.router.navigate(["/editar-perfil"])}toggleDisponibilidad(e){this.actualizando||(this.actualizando=!0,this.usuariosServicio.actualizarPerfil({datosTecnico:{disponibleAhora:e}}).subscribe({next:o=>{this.mostrarToast(e?"Ahora est\xE1s disponible":"Ya no est\xE1s disponible"),this.usuario?.datosTecnico&&(this.usuario.datosTecnico.disponibleAhora=e),this.actualizando=!1},error:()=>{this.mostrarToast("Error al actualizar disponibilidad","danger"),this.disponibleAhora=!e,this.actualizando=!1}}))}toggleEmergencia(e){this.actualizando||(this.actualizando=!0,this.usuariosServicio.actualizarPerfil({datosTecnico:{emergencia24h:e}}).subscribe({next:o=>{this.mostrarToast(e?"Servicio 24/7 activado":"Servicio 24/7 desactivado"),this.usuario?.datosTecnico&&(this.usuario.datosTecnico.emergencia24h=e),this.actualizando=!1},error:()=>{this.mostrarToast("Error al actualizar configuraci\xF3n","danger"),this.emergencia24h=!e,this.actualizando=!1}}))}obtenerEtiquetaEspecialidad(e){return Fe.find(n=>n.valor===e)?.etiqueta||e}obtenerNombreNivel(){return this.fidelizacion?w.find(o=>o.nivel===this.fidelizacion.nivel)?.nombre||this.fidelizacion.nivel:""}obtenerColorNivel(){return this.fidelizacion&&w.find(o=>o.nivel===this.fidelizacion.nivel)?.color||"#CD7F32"}obtenerDireccionTexto(e){if(!e)return"Sin direcci\xF3n";if(typeof e=="string")return e;let o=[];return e.calle&&o.push(e.calle),e.ciudad&&o.push(e.ciudad),e.estado&&o.push(e.estado),e.referencia&&o.push(`(${e.referencia})`),o.length>0?o.join(", "):"Sin direcci\xF3n"}verMisServicios(){this.router.navigate([this.esTecnico?"/mis-trabajos":"/mis-servicios"])}verResenas(){this.router.navigate(["/mis-resenas"])}verMembresias(){this.router.navigate(["/membresias"])}retirarFondos(){this.router.navigate(["/retirar-fondos"])}verFidelizacion(){this.router.navigate(["/fidelizacion"])}verAyuda(){this.router.navigate(["/ayuda"])}verTerminos(){this.router.navigate(["/terminos"])}abrirConfiguracion(){this.router.navigate(["/configuracion"])}cerrarSesion(){return b(this,null,function*(){yield(yield this.alertCtrl.create({header:"Cerrar Sesi\xF3n",message:"\xBFEst\xE1s seguro de que deseas cerrar sesi\xF3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Cerrar Sesi\xF3n",role:"destructive",handler:()=>{this.authServicio.logout(),this.router.navigate(["/bienvenida"])}}]})).present()})}mostrarToast(e,o="success"){return b(this,null,function*(){yield(yield this.toastCtrl.create({message:e,duration:2e3,color:o,position:"bottom"})).present()})}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275cmp=E({type:r,selectors:[["app-perfil"]],standalone:!0,features:[A],decls:10,vars:1,consts:[["slot","end","fill","clear",3,"click"],["name","create-outline"],["slot","fixed",3,"ionRefresh"],[1,"perfil-header"],[1,"avatar-container",3,"click"],["alt","Foto de perfil",3,"src"],[1,"camera-overlay"],["name","camera-outline"],[1,"rol"],["color","success"],[1,"tarjeta-fidelizacion"],["lines","none"],["name","mail-outline","slot","start","color","primary"],["name","call-outline","slot","start","color","primary"],[1,"menu-opciones"],["button","","detail","",3,"click"],["name","briefcase-outline","slot","start","color","primary"],["name","star-outline","slot","start","color","primary"],["button","","detail",""],["name","help-circle-outline","slot","start","color","primary"],["name","document-text-outline","slot","start","color","primary"],["name","settings-outline","slot","start","color","primary"],["button","",1,"cerrar-sesion",3,"click"],["name","log-out-outline","slot","start","color","danger"],["color","danger"],["name","shield-checkmark-outline"],[1,"tarjeta-fidelizacion",3,"click"],[1,"fidelizacion-content"],[1,"nivel-info"],["name","ribbon-outline"],["name","chevron-forward","color","medium"],[1,"tarjeta-estadisticas"],[1,"estadisticas-grid","estadisticas-3col"],[1,"stat-item"],[1,"stat-value"],["name","star","color","warning"],[1,"stat-label"],[1,"stat-item","fondos-item"],[1,"stat-value","fondos-valor"],["name","cash-outline","color","success"],[1,"tarjeta-disponibilidad"],["name","time-outline","slot","start"],[3,"ngModelChange","ngModel"],["name","flash-outline","slot","start"],[1,"especialidades"],["name","location-outline","slot","start","color","primary"],[1,"ion-text-wrap"],["name","diamond-outline","slot","start","color","warning"],["color","warning",2,"margin-left","8px"],["name","wallet-outline","slot","start","color","success"],["color","success",2,"margin-left","8px"],["name","heart-outline","slot","start","color","primary"]],template:function(o,n){o&1&&(i(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),a(3,"Mi Perfil"),t(),i(4,"ion-button",0),m("click",function(){return n.editarPerfil()}),c(5,"ion-icon",1),t()()(),i(6,"ion-content")(7,"ion-refresher",2),m("ionRefresh",function(Ne){return n.refrescar(Ne)}),c(8,"ion-refresher-content"),t(),x(9,Ge,55,13),t()),o&2&&(l(9),g(n.usuario?9:-1))},dependencies:[X,Z,re,ae,$,G,J,K,U,se,Y,te,ee,ie,H,Q,de,ne,oe,R,N,q,L,W],styles:[".perfil-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--ion-color-primary),var(--ion-color-primary-shade));color:#fff;padding:32px 16px;text-align:center}.perfil-header[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]{position:relative;display:inline-block;margin-bottom:16px}.perfil-header[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:100px;height:100px;border:4px solid white;box-shadow:0 4px 12px #0003}.perfil-header[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]   .camera-overlay[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background:var(--ion-color-secondary);width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center}.perfil-header[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]   .camera-overlay[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.perfil-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 4px;font-size:24px;font-weight:600}.perfil-header[_ngcontent-%COMP%]   .rol[_ngcontent-%COMP%]{margin:0 0 12px;opacity:.9;font-size:14px}.tarjeta-fidelizacion[_ngcontent-%COMP%]{margin:16px;border-radius:12px;background:linear-gradient(135deg,#667eea,#764ba2);cursor:pointer}.tarjeta-fidelizacion[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{color:#fff}.tarjeta-fidelizacion[_ngcontent-%COMP%]   .fidelizacion-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.tarjeta-fidelizacion[_ngcontent-%COMP%]   .nivel-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.tarjeta-fidelizacion[_ngcontent-%COMP%]   .nivel-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:40px}.tarjeta-fidelizacion[_ngcontent-%COMP%]   .nivel-info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600}.tarjeta-fidelizacion[_ngcontent-%COMP%]   .nivel-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0 0;opacity:.9;font-size:14px}.tarjeta-estadisticas[_ngcontent-%COMP%]{margin:16px;border-radius:12px}.tarjeta-estadisticas[_ngcontent-%COMP%]   .estadisticas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;text-align:center}.tarjeta-estadisticas[_ngcontent-%COMP%]   .estadisticas-grid.estadisticas-3col[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}.tarjeta-estadisticas[_ngcontent-%COMP%]   .estadisticas-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{padding:8px}.tarjeta-estadisticas[_ngcontent-%COMP%]   .estadisticas-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:4px;font-size:20px;font-weight:700;color:var(--ion-color-primary)}.tarjeta-estadisticas[_ngcontent-%COMP%]   .estadisticas-grid[_ngcontent-%COMP%]   .stat-item.fondos-item[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:var(--ion-color-success);font-size:16px}.tarjeta-estadisticas[_ngcontent-%COMP%]   .estadisticas-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);margin-top:4px}.tarjeta-disponibilidad[_ngcontent-%COMP%]{margin:16px;border-radius:12px}.tarjeta-disponibilidad[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}.especialidades[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px}.menu-opciones[_ngcontent-%COMP%]{margin:16px;border-radius:12px;overflow:hidden}.menu-opciones[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 16px}.menu-opciones[_ngcontent-%COMP%]   .cerrar-sesion[_ngcontent-%COMP%]{--background: transparent;margin-top:8px}"]})}}return r})();export{ui as PerfilPage};
